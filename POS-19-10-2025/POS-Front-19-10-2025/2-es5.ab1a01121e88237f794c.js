!function(){function e(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],n=!0,i=!1,o=void 0;try{for(var a,u=e[Symbol.iterator]();!(n=(a=u.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(s){i=!0,o=s}finally{try{n||null==u.return||u.return()}finally{if(i)throw o}}return r}(e,t)||r(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(e){return function(e){if(Array.isArray(e))return n(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||r(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(e,t){if(e){if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var r,n=d(e);if(t){var i=d(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return s(this,r)}}function s(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{"4o9x":function(r,n,i){"use strict";i.d(n,"a",function(){return E});var s,d=i("mrSG"),c=i("U2wp"),m=i("Mabr"),h=i("cOv9"),T=function e(){l(this,e)},f=i("tiJv"),v=i("e3ir"),D=i("zyXO"),y=i("PSD3"),P=i.n(y),g=i("9qFR"),p=i("bJ22"),I=i("amrp"),x=i("L1NN"),O=i("eUyL"),b=i("b3ex"),S=i("kLqA"),C=i("un1/"),A=i("C5+t"),V=i("fXoL"),w=i("sF2B"),k=i("ig09"),M=i("5eHb"),N=i("E8vI"),F=i("tyNb"),j=i("sYmb"),E=((s=function(r){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}(i,r);var n=u(i);function i(e,t,r,o,a,u){var s,d;return l(this,i),(s=n.call(this)).settingSer=e,s.orderSer=t,s.toastr=r,s.toastrMessage=o,s.router=a,s.translate=u,s.orderdetailobj=new c.a,s.orderPayTypelist=[],s.turkyPaymentSystems=[],s.settingobj=new m.a,s.allproductlist=[],s.userPermissions=[],s.Flds={text:"Name",value:"DocumentId"},s.DiscountFlds={text:"Value",value:"Id"},s.FldsWithId={text:"Name",value:"Id"},s.discountCategories=[],s.isPaymentPrintBtn=!1,s.IsCustomerHasPromo=!1,s.freeProducts=[],s.freeOrderDetail=new c.a,s.freeOrderDetails=[],s.selectedFreeProducts=[],s.integrationSettings=[],s.orderdetailpromoobj=new T,s.report=new Stimulsoft.Report.StiReport,s.counter=0,s.holdedOrdersKey="holdedOrders",s.pendingOrdersKey="pendingOrders",s.pendingOrders=[],s.pendingOrdersCount=0,Stimulsoft.Base.StiLicense.key="6vJhGtLLLz2GNviWmUTrhSqnOItdDwjBylQzQcAOiHlkHnETZDQa/PS+0KAqyGT4DpRlgFmGegaxKasr/6hj3WTsNszXi2AnvR96edDIZl0iQK5oAkmli4CDUblYqrhiAJUrUZtKyoZUOSwbjhyDdjuqCk8reDn/QTemFDwWuF4BfzOqXcdV9ceHmq8jqTiwrgF4Bc35HGUqPq+CnYqGQhfU3YY44xsR5JaAuLAXvuP05Oc6F9BQhBMqb6AUXjeD5T9OJWHiIacwv0LbxJAg5a1dVBDPR9E+nJu2dNxkG4EcLY4nf4tOvUh7uhose6Cp5nMlpfXUnY7k7Lq9r0XE/b+q1f11KCXK/t0GpGNnPL5Xy//JCUP7anSZ0SdSbuW8Spxp+r7StU/XLwt9vqKf5rsY9CN8D8u4Mc8RZiSXceDuKyhQo72Eu8yYFswP9COQ4lgOJGcaCv5h9GwR+Iva+coQENBQyY2dItFpsBwSAPvGs2/4V82ztLMsmkTpoAzYupvE2AoddxArDjjTMeyKowMI6qtTyhaF9zTnJ7X7gs09lgTg7Hey5I1Q66QFfcwK",s.GetSettings(),s.HelperFirstOpen(),s.currentUserLanguage=null===(d=JSON.parse(localStorage.getItem("langs")))||void 0===d?void 0:d.toLowerCase(),s.days=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],s.refreshDateAndTime(),s}return o(i,[{key:"refreshDateAndTime",value:function(){this.currentMachineDayTime=new Date,this.currentMachineTime=this.getTimeString(this.currentMachineDayTime),this.currentMachineDay=this.days[this.currentMachineDayTime.getDay()].toLowerCase(),this.currentMachineDate=this.getOnlyDate(this.currentMachineDayTime)}},{key:"isWeekDayIncluded",value:function(e,t){return e.filter(function(e){return e.Name.toLowerCase()==t.toLowerCase()&&e.IsWork})[0]}},{key:"getTimeString",value:function(e){return e.toTimeString().split(" ")[0]}},{key:"getOnlyDate",value:function(e){var t=e.getDate(),r=e.getMonth(),n=e.getFullYear();return new Date(n,r,t)}},{key:"ngOnInit",value:function(){}},{key:"GetSettings",value:function(){var e=this;this.settingSer.GetSetting().subscribe(function(t){var r=t;e.settingobj=r,e.orderSer.settings=r})}},{key:"HelperFirstOpen",value:function(){var e=this;this.discountCategories=[{Value:5,Id:1},{Value:10,Id:2},{Value:15,Id:3},{Value:20,Id:4},{Value:25,Id:5},{Value:30,Id:6},{Value:40,Id:7},{Value:50,Id:8}],this.orderSer.HelperFirstOpen().subscribe(function(t){var r,n,i,o,a;e.categories=t.Item1,(null===(r=e.categories)||void 0===r?void 0:r.length)&&(e.categories=e.distinct(e.categories,"Value")),e.allorderPayTypelist=t.Item2,e.allorderPayTypelist.forEach(function(t){t.Name=e.getTypeName(t)}),e.orderPayTypelist=e.deepCopy(e.allorderPayTypelist),e.cashBackPayType=e.orderPayTypelist.find(function(e){return 70===e.PayType}),e.defaultSelectedPayType=e.orderPayTypelist[0],e.checkOrderTypePayment(e._orderobj),e.orderPayTypelist&&0!=e.orderPayTypelist.length||e.routIfMissingData("orderpaytype"),e.defaultLanguage=t.Item3.toLowerCase(),e.userPermissions=t.Item4,e.isAdmin=t.Item5,e.allTaxes=t.Item6,e.allinsurancelist=t.Item7,e.turkyPaymentSystems=null===(n=t.Rest)||void 0===n?void 0:n.Item1,e.customerPromos=null===(i=t.Rest)||void 0===i?void 0:i.Item2,e.minimumCharges=null===(o=t.Rest)||void 0===o?void 0:o.Item3,e.myPoint=null===(a=t.Rest)||void 0===a?void 0:a.Item4,e.insurancelist=e.cloneList(e.allinsurancelist)})}},{key:"checkOrderTypePayment",value:function(e){e&&e.OrderType&&1==e.OrderType.MandatoryToSelectThisType&&(e.OrderType.OrderPayTypeDocumentId||e.OrderType.OrderPayTypeId)?(this.orderPayTypelist=this.deepCopy(this.allorderPayTypelist.filter(function(t){return e.OrderType.OrderPayTypeId&&t.Id==e.OrderType.OrderPayTypeId||e.OrderType.OrderPayTypeDocumentId&&t.DocumentId==e.OrderType.OrderPayTypeDocumentId})),!this.orderPayTypelist||1!=this.orderPayTypelist.length||20!=this.orderPayTypelist[0].PayType||e.CustomerDocumentId&&(e.EmployeeId||e.EmployeeDocumentId)||$("#modal-40444").modal("show")):(this.orderPayTypelist=this.deepCopy(this.allorderPayTypelist),e&&e.OrderType&&e.OrderType.MustHaveCustomer&&!e.CustomerDocumentId&&$("#modal-40444").modal("show"))}},{key:"setFocusById",value:function(e){window.setTimeout(function(){var t=document.getElementById(e);t&&t.focus()},200)}},{key:"getNetPrice",value:function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=0,o=(null==n?void 0:n.EditedPrice)?null==n?void 0:n.EditedPrice:e.Price;r||(r=e),r.ProductTaxes||(r.ProductTaxes=[]),o=this.getProductVolumePriceForDetail(n,e,o);var a=r.ProductTaxes.filter(function(e){return e.Tax&&!e.Tax.ExtraTax});if(a&&a.length&&this.settingobj.PriceIncludesTax){var u=null===(t=a[0].Tax)||void 0===t?void 0:t.ValueType,s=a.map(function(e){return e.Tax.Value}).reduce(function(e,t){return Number(e)+Number(t)});i=1==u?o/(1+s/100):o-s}else i=o;return i}},{key:"getProductVolumePriceForDetail",value:function(e,t,r){var n,i,o=this.deepCopy(t);if((null===(n=this.allproductlist)||void 0===n?void 0:n.length)&&((o=this.deepCopy(t.VolumeId||t.VolumeDocumentId||t.VolumeFerpCode?t:this.allproductlist.find(function(e){return e.DocumentId==t.DocumentId})))||(o=this.deepCopy(t))),e&&e.DocumentId&&(e.VolumeId||e.VolumeDocumentId||e.VolumeFerpCode)){var a=t.ProductVolumes;(null===(i=t.ProductVolumes)||void 0===i?void 0:i.length)||(a=null==o?void 0:o.ProductVolumes);var u=null==a?void 0:a.find(function(t){return e.VolumeId&&t.VolumeId===e.VolumeId||e.VolumeDocumentId&&t.VolumeDocumentId===e.VolumeDocumentId||e.VolumeFerpCode&&t.VolumeFerpCode===e.VolumeFerpCode});u&&u.Price&&u.Price!=r&&(r=u.Price)}else!e||e.IsPromo||e.DocumentId||e.VolumeId||e.VolumeDocumentId||e.VolumeFerpCode||(e.ProductPrice=r=e.EditedPrice?e.EditedPrice:o.Price);return r}},{key:"getDeliveryNetPrice",value:function(e,t){return 1==e.ValueType?t/(1+e.Value/100):t-e.Value}},{key:"addProductTaxToOrderDetailTaxes",value:function(e){var t,r,n=this;if(e.TaxForAnotherTax||(e.TaxForAnotherTax=!1),e.taxAmount<0&&(e.taxAmount=0),e.orderDetail.OrderDetailTaxes||(e.orderDetail.OrderDetailTaxes=[]),e.productTaxe.Tax.IncludeOtherTaxes)null===(t=e.productTaxe.Tax.IncludedVATTaxes)||void 0===t||t.forEach(function(t){var r,i=n.allTaxes.find(function(e){return t.Id&&e.Id==t.Id||t.DocumentId&&e.DocumentId==t.DocumentId});i||(i=t);var o={OrderDetailId:0,TaxId:i.Id,TaxDocumentId:i.DocumentId,TaxPercentage:t.Value,TaxValue:e.productPrice*(t.Value/100),ProductDocumentId:e.orderDetail.ProductDocumentId,ProductId:null!==(r=e.orderDetail.ProductId)&&void 0!==r?r:null,TaxForAnotherTax:e.TaxForAnotherTax},a=e.orderDetail.OrderDetailTaxes.findIndex(function(r){return e.TaxForAnotherTax==r.TaxForAnotherTax&&e.orderDetail.ProductDocumentId==r.ProductDocumentId&&(t.Id&&r.TaxId==t.Id||t.DocumentId&&r.TaxDocumentId==t.DocumentId)});-1==a?e.orderDetail.OrderDetailTaxes.push(o):-1!=a&&(e.orderDetail.OrderDetailTaxes[a]=o)});else{var i={OrderDetailId:0,TaxId:e.productTaxe.Tax.Id,TaxDocumentId:e.productTaxe.Tax.DocumentId,TaxPercentage:e.productTaxe.Tax.Value,TaxValue:e.taxAmount,ProductDocumentId:e.orderDetail.ProductDocumentId,ProductId:null!==(r=e.orderDetail.ProductId)&&void 0!==r?r:null,TaxForAnotherTax:e.TaxForAnotherTax},o=e.orderDetail.OrderDetailTaxes.findIndex(function(t){return e.TaxForAnotherTax==t.TaxForAnotherTax&&e.orderDetail.ProductDocumentId==t.ProductDocumentId&&(e.productTaxe.Tax.Id&&t.TaxId==e.productTaxe.Tax.Id||e.productTaxe.Tax.DocumentId&&t.TaxDocumentId==e.productTaxe.Tax.DocumentId)});-1==o?e.orderDetail.OrderDetailTaxes.push(i):-1!=o&&(e.orderDetail.OrderDetailTaxes[o]=i)}}},{key:"addSubItemTaxToOrderDetailTaxes",value:function(e){var t,r,n=this,i=e.subItem,o=e.productTax;if(e.TaxForAnotherTax||(e.TaxForAnotherTax=!1),e.orderDetail.OrderDetailTaxes||(e.orderDetail.OrderDetailTaxes=[]),o.Tax.IncludeOtherTaxes)null===(t=o.Tax.IncludedVATTaxes)||void 0===t||t.forEach(function(t){var r,o=n.allTaxes.find(function(e){return t.Id&&e.Id==t.Id||t.DocumentId&&e.DocumentId==t.DocumentId});o||(o=t);var a={OrderDetailId:0,TaxId:o.Id,TaxDocumentId:o.DocumentId,TaxPercentage:t.Value,TaxValue:e.productPrice*(t.Value/100),ProductDocumentId:i.ProductSubItemDocumentId,ProductId:null!==(r=i.ProductSubItemId)&&void 0!==r?r:null,TaxForAnotherTax:e.TaxForAnotherTax},u=e.orderDetail.OrderDetailTaxes.findIndex(function(r){return e.TaxForAnotherTax==r.TaxForAnotherTax&&i.ProductSubItemDocumentId==r.ProductDocumentId&&(t.Id&&r.TaxId==t.Id||t.DocumentId&&r.TaxDocumentId==t.DocumentId)});-1==u?e.orderDetail.OrderDetailTaxes.push(a):-1!=u&&(e.orderDetail.OrderDetailTaxes[u]=a)});else{var a={OrderDetailId:0,TaxId:o.Tax.Id,TaxDocumentId:o.Tax.DocumentId,TaxPercentage:o.Tax.Value,TaxValue:e.taxAmount,ProductDocumentId:i.ProductSubItemDocumentId,ProductId:null!==(r=i.ProductSubItemId)&&void 0!==r?r:null,TaxForAnotherTax:e.TaxForAnotherTax},u=e.orderDetail.OrderDetailTaxes.findIndex(function(t){var r;return e.TaxForAnotherTax==t.TaxForAnotherTax&&i.ProductSubItemDocumentId==t.ProductDocumentId&&((null===(r=o.Tax)||void 0===r?void 0:r.Id)&&t.TaxId==o.Tax.Id||o.Tax.DocumentId&&t.TaxDocumentId==o.Tax.DocumentId)});-1!=u?e.orderDetail.OrderDetailTaxes[u]=a:e.orderDetail.OrderDetailTaxes.push(a)}}},{key:"addMinChargeTaxToOrderMasterTaxes",value:function(e,t){var r=e.OrderMasterTaxes.filter(function(e){return 2==e.ServiceTaxType})[0];if(this.minimumCharges&&this.minimumCharges.length){var n=this.minimumCharges[0].Tax[0];if(this.minimumCharges&&this.minimumCharges.length&&this.settingobj.UseMinimumCharge&&e.MinimumChargeDifferance>0&&t&&n&&(r?r.TaxAmount=e.MinimumChargeDifferance-e.MinimumChargeDifferance/(n.Value/100+1):e.OrderMasterTaxes.push({Id:t.Id+1,TaxId:n.Id,TaxDocumentId:n.DocumentId,TaxAmount:e.MinimumChargeDifferance-e.MinimumChargeDifferance/(n.Value/100+1),TaxPercentage:n.Value,DocumentId:t.DocumentId,IsDeleted:!1,IsSync:!1,OrderId:t.OrderId,ServiceTaxType:2})),t&&n&&r&&0==e.MinimumChargeDifferance){var i=e.OrderMasterTaxes.indexOf(r);e.OrderMasterTaxes.splice(i)}}}},{key:"addTaxToOrderMasterTaxes",value:function(e){var t,r,n,i,o,a=this,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e.OrderMasterTaxes||(e.OrderMasterTaxes=[]),this.taxFound=e.OrderMasterTaxes.filter(function(e){return u.TaxId&&e.TaxId==u.TaxId||e.TaxDocumentId==u.TaxDocumentId})[0],this.settingobj.UseMinimumCharge&&1==e.HasMinimumCharge&&e.MinimumChargeDifferance>0&&(null===(t=this.minimumCharges)||void 0===t?void 0:t.length)&&(null===(n=null===(r=this.minimumCharges[0])||void 0===r?void 0:r.Tax)||void 0===n?void 0:n.length)&&(null===(o=null===(i=this.minimumCharges[0])||void 0===i?void 0:i.Tax[0])||void 0===o?void 0:o.DocumentId)&&(this.taxFound=this.allTaxes.filter(function(e){return e.DocumentId==a.minimumCharges[0].Tax[0].DocumentId})[0],this.addMinChargeTaxToOrderMasterTaxes(e,this.taxFound)),this.taxFound){var s=Number(u.TaxAmount),d=Number(u.TaxPercentage),l=e.OrderMasterTaxes.findIndex(function(e){return u.TaxId&&e.TaxId==u.TaxId||e.TaxDocumentId==u.TaxDocumentId});-1!=l&&(e.OrderMasterTaxes[l]={Id:this.taxFound.Id,TaxId:u.TaxId,TaxDocumentId:u.TaxDocumentId,TaxAmount:s,TaxPercentage:d,DocumentId:this.taxFound.DocumentId,IsDeleted:!1,IsSync:!1,OrderId:this.taxFound.OrderId,ServiceTaxType:this.taxFound.ServiceTaxType})}else e.OrderMasterTaxes.push({Id:0,TaxId:u.TaxId,TaxDocumentId:u.TaxDocumentId,TaxAmount:u.TaxAmount,TaxPercentage:u.TaxPercentage,DocumentId:"",IsDeleted:!1,IsSync:!1,OrderId:"",ServiceTaxType:u.ServiceTaxType})}},{key:"handleWhenPriceIncludesTax",value:function(e,t){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new h.a,i=0;t.TaxPercentage=0,t.TaxAmount=0,t.TaxName="";var o={SideDishTaxAmount:0,SideDishNetPrice:0};this.calculateSideDishTaxAmount(t,o);var a=o.SideDishTaxAmount,u=o.SideDishNetPrice;return e.ProductTaxes.forEach(function(o){var s,d=0;s=o.Tax.Value,o.Tax&&(t.TaxName+="+ "+r.getTypeName(o.Tax)),t.TaxId=o.Tax.Id,t.TaxDocumentId=o.Tax.DocumentId,!n.IntegrationSystem||Number(n.IntegrationSystem)<1?(i=r.getNetPrice(e,null,t),t.ProductPrice=i):(i=t.RealPrice/(1+s/100),t.ProductPrice=i),!1===r.settingobj.CalculateTaxBeforeDiscount&&(0!==e.DiscountValue||t.DiscountPercentage>0||t.OrderDiscountValue>0)&&(i=i-Number(t.OrderDiscountValue)-Number(t.DiscountAmount)),d=s>0?i*(s/100):0,i&&o.Tax&&o.Tax.ExtraTax&&o.Tax.MinimumValue&&d<o.Tax.MinimumValue&&(t.TaxDifferenceValue=o.Tax.MinimumValue-d,d=o.Tax.MinimumValue),(100===n.Discount&&"1"===n.DiscountType||n.Discount===n.NetTotal&&"2"===n.DiscountType)&&(a=0,d=0,t.Product.TaxValue=0,t.SideDishTaxAmount=0,n.RemainigAmount=0),d<0&&(d=0),t.Product.TaxValue=d,t.SideDishTaxAmount=a,t.SideDishNetPrice=u,0===n.Discount&&(t.SideDishesValue=t.SideDishNetPrice+t.SideDishTaxAmount),r.addProductTaxToOrderDetailTaxes({product:e,orderDetail:t,taxAmount:d,productPrice:i,productTaxe:o}),d=r.calculateTaxHasVatTax(o,d,e,t),t.TaxAmount+=d,t.TaxPercentage+=s}),t}},{key:"handleWhenPriceNotIncludesTax",value:function(e,t){var r=this;t.TaxPercentage=0,t.TaxAmount=0,t.TaxName="";var n={SideDishTaxAmount:0,SideDishNetPrice:0};this.calculateSideDishTaxAmount(t,n);var i=n.SideDishTaxAmount,o=n.SideDishNetPrice;return e.ProductTaxes.forEach(function(n){var i=0,o=0;if(i+=n.Tax.Value,n.Tax&&(t.TaxName+="+ "+r.getTypeName(n.Tax)),t.TaxId=n.Tax.Id,t.TaxDocumentId=n.Tax.DocumentId,!1===r.settingobj.CalculateTaxBeforeDiscount&&(0!=t.DiscountPercentage||0!=e.DiscountValue||t.OrderDiscountValue>0)){var a=0;(a=t.RealPrice-t.OrderDiscountValue-t.DiscountAmount)<0&&(a=0),(o=a*(i/100))||(o=0),a&&n.Tax&&n.Tax.ExtraTax&&n.Tax.MinimumValue&&o<n.Tax.MinimumValue&&(t.TaxDifferenceValue=n.Tax.MinimumValue-o,o=n.Tax.MinimumValue),t.Product.TaxValue=o,a<=0&&(t.SideDishTaxAmount=0),r.addProductTaxToOrderDetailTaxes({product:e,orderDetail:t,taxAmount:o,productPrice:a,productTaxe:n})}else o=i>0?t.ProductPrice*(i/100):0,n.Tax&&n.Tax.ExtraTax&&n.Tax.MinimumValue&&o<n.Tax.MinimumValue&&(t.TaxDifferenceValue=n.Tax.MinimumValue-o,o=n.Tax.MinimumValue),r.addProductTaxToOrderDetailTaxes({product:e,orderDetail:t,taxAmount:o,productPrice:e.Price,productTaxe:n});o=r.calculateTaxHasVatTax(n,o,e,t),t.TaxAmount+=o,t.TaxPercentage+=i}),t.SideDishTaxAmount=i,t.SideDishNetPrice=o,t.SideDishesValue=t.SideDishNetPrice+t.SideDishTaxAmount,t}},{key:"calculateTaxHasVatTax",value:function(e,t,r,n){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(e.Tax&&e.Tax.HasVATTax&&e.Tax.VATTax){var o=this.allTaxes.find(function(t){return e.Tax.VATTax.Id&&t.Id==e.Tax.VATTax.Id||e.Tax.VATTax.DocumentId&&t.DocumentId==e.Tax.VATTax.DocumentId});o||(o=e.Tax.VATTax);var a=o.Value>0?t*(o.Value/100):0,u={Tax:o,TaxId:o.Id,TaxDocumentId:o.DocumentId,ProductId:r.Id,ProductDocumentId:r.DocumentId};i?this.addSubItemTaxToOrderDetailTaxes({orderDetail:n,subItem:r,productTax:u,taxAmount:a,productPrice:t,TaxForAnotherTax:!0}):this.addProductTaxToOrderDetailTaxes({product:r,orderDetail:n,taxAmount:a,productPrice:t,productTaxe:u,TaxForAnotherTax:!0}),t+=t*(e.Tax.VATTax.Value/100)}return t}},{key:"getSubItemOriginalProduct",value:function(e){var t=e.productSubitem;return this.allproductlist&&this.allproductlist.length&&(t=this.allproductlist.find(function(t){return e.ProductSubItemId&&t.Id==e.ProductSubItemId||t.DocumentId==e.ProductSubItemDocumentId}),e.productSubitem=this.deepCopy(t)),t}},{key:"calculateSideDishTaxAmount",value:function(e,t){var r,n=this;(null===(r=null==e?void 0:e.OrderDetailSubItems)||void 0===r?void 0:r.length)>0&&e.OrderDetailSubItems.forEach(function(r){var i,o=n.getSubItemOriginalProduct(r);r.TaxPercentage=0,r.TaxAmount=0,r.OrderDiscountValue||(r.OrderDiscountValue=0),r.RealPrice=r.Price;var a=n.getNetPrice(r,o);r.ProductPrice=a;var u=a;!1===n.settingobj.CalculateTaxBeforeDiscount&&(r.OrderDiscountValue>0||r.DiscountAmount>0)&&(u=u-r.OrderDiscountValue-r.DiscountAmount),null===(i=null==o?void 0:o.ProductTaxes)||void 0===i||i.forEach(function(t){r.Tax=t.Tax,r.TaxDocumentId=t.Tax.DocumentId,r.TaxId=t.Tax.Id,r.TaxPercentage+=r.Tax.Value;var i=r.Tax.Value>0?u*(r.Tax.Value/100):0;u&&t.Tax&&t.Tax.ExtraTax&&t.Tax.MinimumValue&&i<t.Tax.MinimumValue&&(r.TaxDifferenceValue=t.Tax.MinimumValue-i,i=t.Tax.MinimumValue),n.addSubItemTaxToOrderDetailTaxes({orderDetail:e,subItem:r,productTax:t,taxAmount:i,productPrice:a}),i=n.calculateTaxHasVatTax(t,i,r,e,!0),r.TaxAmount+=i}),r.ProductFinalPrice=a+r.TaxAmount,t.SideDishTaxAmount+=r.TaxAmount*r.Quantity,t.SideDishNetPrice+=a*r.Quantity})}},{key:"handelProductDiscount",value:function(e,t,r){var n,i,o=this;e.DiscountValue||(e.DiscountValue=0),t.DiscountPercentage||(t.DiscountPercentage=0),r.Discount||(r.Discount=0),r.DiscountAmount||(r.DiscountAmount=0),t.ProductFinalPrice||(t.ProductFinalPrice=0),t.OrderDiscountValueToShow||(t.OrderDiscountValueToShow=0),t.SubItemDiscountValue=0,t.TotalSubItemDisountAmount=0,t.SideDishesValue&&"number"==typeof t.SideDishesValue||(t.SideDishesValue=0),t.DiscountAmount||(t.DiscountAmount=0),r.IntegrationSystem&&!(Number(r.IntegrationSystem)<1)||r.IsCallCenter||r.IsMobileOrder||(e.Price=this.getProductVolumePriceForDetail(t,e,e.Price),t.RealPrice=e.Price);var a=e.DiscountValue||t.DiscountPercentage,u=e.Price;this.settingobj.PriceIncludesTax&&(u=this.getNetPrice(e,null,t));var s=0;if(a&&(s=u*a/100),(0===t.DiscountAmount||e.AllowChangePrice)&&(t.DiscountAmount=s),a&&!r.DiscountType&&(r.DiscountType="1"),"1"==r.DiscountType)t.OrderDiscountValue=Number(r.Discount)/100*(u-s),(null===(n=null==t?void 0:t.OrderDetailSubItems)||void 0===n?void 0:n.length)>0&&t.OrderDetailSubItems.forEach(function(e){var n=o.getSubItemOriginalProduct(e),i=o.getNetPrice(e,n);e.DiscountAmount=Number(a)/100*i,e.OrderDiscountValue=Number(r.Discount)/100*(i-e.DiscountAmount),t.OrderDiscountValueToShow=e.OrderDiscountValue,t.SubItemDiscountValue+=e.OrderDiscountValue,t.TotalSubItemDisountAmount+=e.DiscountAmount}),t.OrderDiscountValueToShow=t.OrderDiscountValue;else if("2"==r.DiscountType){var d=0;r.OrderDetails.forEach(function(e){var n,i;e.Product||(e.Product=null===(n=o.allproductlist)||void 0===n?void 0:n.find(function(t){return t.DocumentId==e.ProductDocumentId}));var a=null===(i=e.Product)||void 0===i?void 0:i.Price;o.settingobj.PriceIncludesTax?(r.Discount=e.Product.Tax?r.Discount/(1+e.Product.Tax.Value/100):r.Discount,a=o.getNetPrice(e.Product,null,t),e.TaxPercentage=e.Product.Tax?e.Product.Tax.Value:0,d+=e.SideDishesValue>0?(a+e.SideDishesValue/(1+e.TaxPercentage/100)-e.DiscountAmount)*e.ProductQuantity:(a-e.DiscountAmount)*e.ProductQuantity):d+=e.SideDishesValue>0?(a+e.SideDishesValue-e.DiscountAmount)*e.ProductQuantity:(a-e.DiscountAmount)*e.ProductQuantity});var l=r.Discount/d*100;t.OrderDiscountValue=l>0?l/100*(u-s):0,(null===(i=null==t?void 0:t.OrderDetailSubItems)||void 0===i?void 0:i.length)>0&&t.OrderDetailSubItems.forEach(function(e){var r=o.getSubItemOriginalProduct(e),n=o.getNetPrice(e,r);e.DiscountAmount=Number(a)/100*n,e.OrderDiscountValue=l>0?l/100*(n-e.DiscountAmount):0,t.OrderDiscountValueToShow=e.OrderDiscountValue,t.TotalSubItemDisountAmount+=e.DiscountAmount,t.SubItemDiscountValue+=e.OrderDiscountValue}),t.OrderDiscountValueToShow=t.OrderDiscountValue+t.SubItemDiscountValue}else t.OrderDiscountValue=0,t.OrderDiscountValueToShow=0,t.SubItemDiscountValue=0,t.OrderDetailSubItems&&t.OrderDetailSubItems.forEach(function(e){return e.OrderDiscountValue=0});return t.OrderDiscountValue&&t.OrderDiscountValueToShow||(t.OrderDiscountValue=0,t.OrderDiscountValueToShow=0),t}},{key:"handelProductTax",value:function(e,t){var r,n,i,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new h.a;if(t.TaxAmount||(t.TaxAmount=0),t.SideDishNetPrice||(t.SideDishNetPrice=0),t.SideDishTaxAmount||(t.SideDishTaxAmount=0),t.SubItemDiscountValue||(t.SubItemDiscountValue=0),e.ProductTaxes&&e.ProductTaxes.length)t.SideDishesValue&&"number"==typeof t.SideDishesValue||(t.SideDishesValue=0),t=this.settingobj.PriceIncludesTax||o.IsCallCenter&&(null===(r=this.pos)||void 0===r?void 0:r.LinkWithOnlineOrder)||o.IsMobileOrder?this.handleWhenPriceIncludesTax(e,t,o):this.handleWhenPriceNotIncludesTax(e,t);else if(!e.ProductTaxes||0==e.ProductTaxes.length){var a=0,u=0;if((null===(n=null==t?void 0:t.OrderDetailSubItems)||void 0===n?void 0:n.length)>0){t.OrderDetailSubItems.forEach(function(t){var r;void 0!==t.Tax&&void 0!==t.TaxDocumentId&&void 0!==t.TaxId&&void 0!==t.TaxPercentage&&void 0!==t.TaxAmount||(t.Tax=null==e?void 0:e.Tax,t.TaxDocumentId=null==e?void 0:e.TaxDocumentId,t.TaxId=null==e?void 0:e.TaxId,t.RealPrice=null==t?void 0:t.Price,t.ProductPrice=null==t?void 0:t.RealPrice,t.TaxAmount=(null==t?void 0:t.RealPrice)-(null==t?void 0:t.ProductPrice),t.TaxPercentage=null===(r=null==t?void 0:t.Tax)||void 0===r?void 0:r.Value)});for(var s=0;s<t.OrderDetailSubItems.length;s++)t.OrderDetailSubItems[s].TaxAmount<0&&(t.OrderDetailSubItems[s].TaxAmount=0),a+=t.OrderDetailSubItems[s].TaxAmount*t.OrderDetailSubItems[s].Quantity,u+=t.OrderDetailSubItems[s].ProductPrice*t.OrderDetailSubItems[s].Quantity}t.SideDishTaxAmount=a,t.SideDishNetPrice=u,t.SideDishesValue=t.SideDishNetPrice+t.SideDishTaxAmount,o.IntegrationSystem>0&&(t.ProductPrice=t.RealPrice)}return t.ProductFinalPrice||(t.ProductFinalPrice=0),t.ProductFinalPrice=t.ProductPrice-t.DiscountAmount-t.OrderDiscountValue+t.TaxAmount,t.ProductFinalPrice<0&&(t.ProductFinalPrice=0,t.SideDishTaxAmount=0,t.SideDishesValue=0),!t.ProductPrice&&(t.TaxAmount>0||(null===(i=t.OrderDetailTaxes)||void 0===i?void 0:i.length))&&(t.TaxAmount=0,t.OrderDetailTaxes=[]),t}},{key:"handleServiceCharge",value:function(e){var t,r=this,n=0,i=0,o=0,a=0,u=0;if(e.ServiceChargeValue||(e.ServiceChargeValue=0),100==e.Discount&&"1"==e.DiscountType||e.CancelServices)e.ServiceChargeValue=0,e.OrderMasterTaxes=[];else if(e.OrderType&&e.OrderType.Taxes&&e.OrderType.Taxes.length>0){e.OrderType.Taxes.forEach(function(t){var s;if(t.Tax){if(1==t.Tax.ValueType){var d=0;n+=t.Tax.Value;var l=e.NetTotal;(null===(s=r.settingobj)||void 0===s?void 0:s.IsServiceFromTotalWithVat)&&(l+=e.TotalTaxAmount),(d=r.settingobj&&r.settingobj.IsServiceFromRealPrice?l*(t.Tax.Value/100):(l-Number(e.DiscountAmount)-Number(e.DetailsDiscount))*(t.Tax.Value/100))<0&&(d=0),i+=d,o=d,a=t.Tax.Value}else if(2==t.Tax.ValueType){var c,m=t.Tax.Value;t.Tax.ForOnePerson&&e.PersonsCount&&(m=e.SubTotal?t.Tax.Value*e.PersonsCount:0),i+=m,c=r.settingobj&&r.settingobj.IsServiceFromRealPrice?m/e.NetTotal*100:m/(e.NetTotal-Number(e.DiscountAmount)-Number(e.DetailsDiscount))*100,n+=c,a=c,o=m}var h=r.allTaxes.find(function(e){return t.Tax.Id&&e.Id==t.Tax.Id||t.Tax.DocumentId&&e.DocumentId==t.Tax.DocumentId});if(h||(h=t.Tax),r.addTaxToOrderMasterTaxes(e,{TaxId:h.Id,TaxDocumentId:h.DocumentId,TaxAmount:o,TaxPercentage:a,Tax:h,ServiceTaxType:3}),t.Tax.IncludedVATTaxes&&t.Tax.IncludedVATTaxes.length>0&&!t.Tax.VATTax&&(t.Tax.VATTax=t.Tax.IncludedVATTaxes[0],t.Tax.HasVATTax=!0,t.Tax.VATTaxDocumentId=t.Tax.VATTax.DocumentId,t.Tax.VATTaxId=t.Tax.VATTax.Id),t.Tax.HasVATTax&&t.Tax.VATTax)if(u+=o*(t.Tax.VATTax.Value/100),t.Tax.VATTax.IncludeOtherTaxes&&t.Tax.VATTax.IncludedVATTaxes)t.Tax.VATTax.IncludedVATTaxes.forEach(function(t){var n=r.allTaxes.find(function(e){return t.Id&&e.Id==t.Id||t.DocumentId&&e.DocumentId==t.DocumentId});n||(n=t),r.addTaxToOrderMasterTaxes(e,{TaxId:n.Id,TaxDocumentId:n.DocumentId,TaxAmount:o*(t.Value/100),TaxPercentage:n.Value,Tax:n,ServiceTaxType:3})});else{var T=r.allTaxes.find(function(e){return t.Tax.VATTaxId&&e.Id==t.Tax.VATTaxId||t.Tax.VATTaxDocumentId&&e.DocumentId==t.Tax.VATTaxDocumentId});T||(T=t.Tax.VATTax),r.addTaxToOrderMasterTaxes(e,{TaxId:T.Id,TaxDocumentId:T.DocumentId,TaxAmount:u,TaxPercentage:T.Value,Tax:T,ServiceTaxType:3})}}});var s=null===(t=e.OrderMasterTaxes)||void 0===t?void 0:t.filter(function(e){return!e.TaxId&&!e.TaxDocumentId});s&&s.length>0&&s.forEach(function(t){var r=e.OrderMasterTaxes.indexOf(t);-1!=r&&e.OrderMasterTaxes.splice(r,1)})}else e.OrderMasterTaxes=[];e.ChannelName?e.ServiceChargePercentage=null!=e.ServiceChargeValue?e.ServiceChargeValue/e.SubTotal:0:(e.ServiceChargeValue=i,e.ServiceChargePercentage=n),e.ServiceChargeValue>0&&e.OrderDetails&&e.OrderDetails.length>0?e.OrderDetails.forEach(function(t){if(r.settingobj&&r.settingobj.IsServiceFromRealPrice)t.ServiceChargeValue=Number(e.ServiceChargePercentage)/100*t.ProductPrice,u>0&&(t.ServiceChargeValue+=u*(t.ProductPrice/e.NetTotal));else if(t.ServiceChargeValue=Number(e.ServiceChargePercentage)/100*(t.ProductPrice-t.DiscountAmount-t.OrderDiscountValue),u>0){var n=(t.ProductPrice-t.DiscountAmount-t.OrderDiscountValue)/(e.NetTotal-Number(e.DiscountAmount)-Number(e.DetailsDiscount));t.ServiceChargeValue+=u*n}}):0==e.ServiceChargeValue&&e.OrderDetails&&e.OrderDetails.length>0&&e.OrderDetails.forEach(function(e){e.ServiceChargeValue=0}),e.TotalTaxAmount+=u,e.SubTotal+=e.ServiceChargeValue+u}},{key:"handleDeliveryTax",value:function(e){var t,r=this;if(e.TotalTaxAmount||(e.TotalTaxAmount=0),e.DeliveryNetPrice=0,e.DeliveryPrice>0&&this.settingobj&&this.settingobj.ApplyTaxOnDeliveryPrice&&this.settingobj.TaxDocumentId){var n=this.allTaxes.filter(function(e){return e.DocumentId==r.settingobj.TaxDocumentId})[0];if(n){var i=0,o=0;if(this.settingobj.PriceIncludesTax){if(1==n.ValueType){var a=this.getDeliveryNetPrice(n,e.DeliveryPrice);e.DeliveryNetPrice=a,i=a*n.Value/100,o=n.Value}else if(2==n.ValueType){var u=this.getDeliveryNetPrice(n,e.DeliveryPrice);e.DeliveryNetPrice=u,i=n.Value,o=n.Value/u*100}}else 1==n.ValueType?(i=e.DeliveryPrice*n.Value/100,o=n.Value):2==n.ValueType&&(i=n.Value,o=n.Value/e.DeliveryPrice*100),e.SubTotal+=i;this.addTaxToOrderMasterTaxes(e,{TaxId:n.Id,TaxDocumentId:n.DocumentId,TaxAmount:i,TaxPercentage:o,Tax:n,ServiceTaxType:1});var s=null===(t=e.OrderMasterTaxes)||void 0===t?void 0:t.filter(function(e){return!e.TaxId&&!e.TaxDocumentId});s&&s.length>0&&s.forEach(function(t){var r=e.OrderMasterTaxes.indexOf(t);-1!=r&&e.OrderMasterTaxes.splice(r,1)}),e.TotalTaxAmount+=i}}}},{key:"handlePromo",value:function(e,r,n){var i,o,a,u,s,d,l,c,m,h=this;if(this.refreshDateAndTime(),e.Promos&&e.Promos.length>0){var T,f=e.Promos.filter(function(e){return h.chekWithinTime(e)}),v=(null==r?void 0:r.VolumeDocumentId)||e.VolumeDocumentId;v&&(f=f.filter(function(t){return t.PromoProducts.some(function(t){return t.TakeProductVolumeDocumentId==v&&t.TakeProductDocumentId==e.DocumentId})})),e.Promos=[],e.ShowDiscount=!1,f.length&&(T=e.Promos).push.apply(T,t(f));var D=null!==(o=null===(i=null==n?void 0:n.OrderPayments)||void 0===i?void 0:i.flatMap(function(e){return e.PayTypeDocumentId}))&&void 0!==o?o:[];f=f.filter(function(e){var t;return!(null===(t=e.OrderPayTypesList)||void 0===t?void 0:t.length)||(null==D?void 0:D.length)&&(null==D?void 0:D.every(function(t){return e.OrderPayTypesList.includes(t)}))});var y=(null===(a=null==n?void 0:n.OrderType)||void 0===a?void 0:a.DocumentId)||(null===(s=null===(u=this.orderobj)||void 0===u?void 0:u.OrderType)||void 0===s?void 0:s.DocumentId)||(null===(d=this.pointOfSale)||void 0===d?void 0:d.OrderTypeId)||(null===(l=null==n?void 0:n.pointOfSale)||void 0===l?void 0:l.OrderTypeId)||(null===(m=null===(c=this.orderobj)||void 0===c?void 0:c.pointOfSale)||void 0===m?void 0:m.OrderTypeId),P=(f=f.filter(function(e){var t;return!y||!(null===(t=e.OrderTypesList)||void 0===t?void 0:t.length)||e.OrderTypesList.find(function(e){return y==e})}))[0];P?1!=P.ValueType&&5!=P.ValueType||(e.ShowDiscount=!0,1==P.ValueType&&(e.DiscountValue=P.Value)):P||!r||(null==r?void 0:r.IsPromo)||(e.DiscountValue=0,r.DiscountAmount=0,r.DiscountPercentage=0)}return r}},{key:"assignPromoCustomPrice",value:function(e){var t,r,n,i,o,a,u,s=this,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,l=(null===(t=e.Promos)||void 0===t?void 0:t.length)?e.Promos[0]:void 0;if(l&&(!(null===(r=null==l?void 0:l.OrderTypesList)||void 0===r?void 0:r.length)||l.OrderTypesList.find(function(e){var t;return e==(null===(t=s.orderobj)||void 0===t?void 0:t.OrderType.DocumentId)})&&(null===(i=null===(n=this.orderobj)||void 0===n?void 0:n.OrderType)||void 0===i?void 0:i.IsPromo))&&(null===(o=e.Promos)||void 0===o?void 0:o.length)&&e.Promos.some(function(e){return 5==e.ValueType})){var c=null===(u=null===(a=e.Promos.find(function(e){return 5==e.ValueType}))||void 0===a?void 0:a.PromoProducts)||void 0===u?void 0:u.filter(function(t){return t.TakeProductDocumentId==e.DocumentId});(null==c?void 0:c.length)&&(null==d?void 0:d.length)>0&&d.forEach(function(e){var t,r=null===(t=s.volumes)||void 0===t?void 0:t.find(function(t){return e.VolumeDocumentId&&e.VolumeDocumentId==t.DocumentId||e.VolumeId&&e.VolumeId==t.Id}),n=c.find(function(e){return e.TakeProductVolumeDocumentId==(null==r?void 0:r.DocumentId)});n&&(e.Price=n.CustomPrice)}),(null==c?void 0:c.length)&&e.VolumeDocumentId&&(c=c.filter(function(t){return t.TakeProductVolumeDocumentId==e.VolumeDocumentId&&t.TakeProductDocumentId==e.DocumentId})),(null==c?void 0:c.length)&&(e.Price=c[0].CustomPrice)}}},{key:"oldchekWithinTime",value:function(e){var t=this.getTimeString(new Date(e.FromTime)),r=this.getTimeString(new Date(e.ToTime)),n=this.getOnlyDate(new Date(e.FromDate)),i=this.getOnlyDate(new Date(e.ToDate));return this.isWeekDayIncluded(e.WorkDays,this.currentMachineDay)&&t<=this.currentMachineTime&&r>=this.currentMachineTime&&n<=this.currentMachineDate&&i>=this.currentMachineDate}},{key:"chekWithinTime",value:function(e){var t=this.getTimeString(new Date(e.FromTime)),r=this.getTimeString(new Date(e.ToTime)),n=this.getOnlyDate(new Date(e.FromDate)),i=this.getOnlyDate(new Date(e.ToDate)),o=this.currentMachineDayTime,a=new Date("".concat(Object(C.f)(n),"T").concat(t)),u=new Date("".concat(Object(C.f)(i),"T").concat(r));return u<=a&&(u.setDate(u.getDate()+1),i.setDate(i.getDate()+1)),this.isWeekDayIncluded(e.WorkDays,this.currentMachineDay)&&o>=a&&o<=u&&this.currentMachineDate>=n&&this.currentMachineDate<=i}},{key:"handelCustomerPromos",value:function(e,t){var r,n=this;if(this.refreshDateAndTime(),this.customerPromos&&this.customerPromos.length&&e.CustomerDocumentId){var i=this.customerPromos.filter(function(t){return t.CustomersList&&t.CustomersList.includes(e.CustomerDocumentId)&&n.chekWithinTime(t)})[0];i&&i.ValueType&&i.Value&&(null===(r=i.OrderTypesList)||void 0===r||r.find(function(t){return t===e.OrderTypeDocumentId}),i.IsAppliedToProducts?i.IsAppliedToProducts&&e.OrderDetails.forEach(function(e){for(var t=0;t<i.ProductList.length;t++)i.ProductList[t]===e.ProductDocumentId&&(e.DiscountPercentage=i.Value)}):(e.DiscountType=i.ValueType,e.Discount=i.Value))}}},{key:"handelMinimumCharge",value:function(e,t){var r,n,i,o,a,u;if(this.refreshDateAndTime(),this.minimumCharges&&this.minimumCharges.length&&this.settingobj.UseMinimumCharge&&t.PersonsCount&&t.TableId){var s=null!==(r=null==e?void 0:e.DocumentId)&&void 0!==r?r:t.TableId,d=null===(i=null===(n=this.minimumCharges[0])||void 0===n?void 0:n.Tables)||void 0===i?void 0:i.filter(function(e){return e.DocumentId==s})[0];d&&this.isWeekDayIncluded(null===(o=this.minimumCharges[0])||void 0===o?void 0:o.WorkDays,this.currentMachineDay)&&this.getTimeString(new Date(null===(a=this.minimumCharges[0])||void 0===a?void 0:a.TimeFrom))<=this.currentMachineTime&&this.getTimeString(new Date(null===(u=this.minimumCharges[0])||void 0===u?void 0:u.TimeTo))>=this.currentMachineTime&&d&&d.ValuePerPerson&&d.OrderTypesList&&t.PersonsCount&&(this.orderobj.MinimumChargeValue=t.MinimumChargeNewPerPerson?t.PersonsCount*t.MinimumChargeNewPerPerson:t.PersonsCount*d.ValuePerPerson)}}},{key:"calculateOrderDetailTotal",value:function(e){arguments.length>1&&void 0!==arguments[1]||new h.a;var t=0;return e.TaxAmount||(e.TaxAmount=0),e.DiscountAmount||(e.DiscountAmount=0),e.OrderDiscountValue||(e.OrderDiscountValue=0),e.OrderDiscountValueToShow||(e.OrderDiscountValueToShow=0),t=(e.ProductPrice+e.TaxAmount-e.DiscountAmount-e.OrderDiscountValue-e.SubItemDiscountValue-e.TotalSubItemDisountAmount)*e.ProductQuantity,null!=e.SideDishNetPrice&&(t+=e.SideDishNetPrice+e.SideDishTaxAmount),t<0&&(t=0),t}},{key:"calculateTotals",value:function(e,t){if(e.NetTotal=0,e.TotalInsuranceAmount=0,e.DetailsDiscount=0,e.TotalTaxAmount=0,e.DiscountAmount||(e.DiscountAmount=0),e.Discount||(e.Discount=0),e.ServiceChargeValue||(e.ServiceChargeValue=0),e.DeliveryPrice=e.DeliveryPrice?Number(e.DeliveryPrice):0,e.DeliveryPersonDeliveryPrice=e.DeliveryPersonDeliveryPrice?Number(e.DeliveryPersonDeliveryPrice):0,e.OrderInsurance&&e.OrderInsurance.OrderInsuranceDetails&&e.OrderInsurance.OrderInsuranceDetails.length>0){var r=e.OrderInsurance.OrderInsuranceDetails.reduce(function(e,t){return e+Number(t.Quantity)*Number(t.Price)},0);e.TotalInsuranceAmount=r||0}if(0!=e.OrderDetails.length||null!=e.OrderDetails){if(e.OrderDetails.forEach(function(t){var r=0;t.SideDishNetPrice&&"number"==typeof t.SideDishNetPrice&&(r=t.SideDishNetPrice),e.NetTotal+=t.ProductPrice*t.ProductQuantity+r,t.InsuranceValue||(t.InsuranceValue=0),t.DiscountAmount||(t.DiscountAmount=0),t.TaxAmount||(t.TaxAmount=0),t.TotalSubItemDisountAmount||(t.TotalSubItemDisountAmount=0),e.DetailsDiscount+=(t.DiscountAmount+t.TotalSubItemDisountAmount)*t.ProductQuantity,e.TotalTaxAmount+=t.SideDishTaxAmount?t.TaxAmount*t.ProductQuantity+t.SideDishTaxAmount:t.TaxAmount*t.ProductQuantity}),"1"==e.DiscountType)e.DiscountAmount=Number(e.Discount)/100*(e.NetTotal-e.DetailsDiscount),100==e.Discount&&(e.DeliveryPrice=0,e.DeliveryPersonDeliveryPrice=0,e.TotalTaxAmount=0);else if("2"==e.DiscountType&&e.NetTotal>0){var n=Number(e.Discount)/(e.NetTotal-e.DetailsDiscount)*100;e.DiscountAmount=n/100*(e.NetTotal-e.DetailsDiscount)}e.Total=e.NetTotal-e.DetailsDiscount-e.DiscountAmount+e.TotalTaxAmount,e.Total<0&&(e.Total=0),e.SubTotal=e.NetTotal-e.DetailsDiscount-e.DiscountAmount+e.TotalTaxAmount+Number(e.DeliveryPrice),e.SubTotal<=0&&(e.SubTotal=0,e.RemainigAmount=0),e=this.handelDriverSettings(e),this.handleServiceCharge(e),this.handleDeliveryTax(e),this.handleRoundingFraction(e),this.calculateOrderPayments(e,t),localStorage.setItem("orderobj",JSON.stringify(e))}}},{key:"recalculateSideDishesValue",value:function(e){var t=this;e.SideDishesValue=0,e.OrderDetailSubItems&&e.OrderDetailSubItems.length>0&&e.OrderDetailSubItems.forEach(function(r){var n=t.deepCopy(t.orderSer.originalProductList.find(function(e){return r.ProductSubItemId&&e.Id==r.ProductSubItemId||r.ProductSubItemDocumentId&&e.DocumentId==r.ProductSubItemDocumentId})),i=e.ProductQuantity;i||(i=0),r.Price||(r.Price=0),(null==n?void 0:n.UseWeights)||i%1==0||(i=i<1?1:Math.floor(i)),r.Quantity=Number(i)*Number(r.SingleQuantity),e.SideDishesValue+=r.Quantity*Number(r.Price)})}},{key:"handleRoundingFraction",value:function(e){if(this.settingobj&&this.settingobj.RoundingMethod>0&&this.settingobj.RoundingLevel>0){var t,r=e.SubTotal;switch(this.settingobj.RoundingLevel){case.01:e.SubTotal=Number((this.getRoundedNumber(100*e.SubTotal)/100).toFixed(2));break;case.25:e.SubTotal=Number((this.getRoundedNumber(4*e.SubTotal)/4).toFixed(2));break;case.05:e.SubTotal=Number((this.getRoundedNumber(20*e.SubTotal)/20).toFixed(2));break;case.1:t=Math.pow(10,1),e.SubTotal=this.getRoundedNumber(e.SubTotal*t)/t;break;case.5:e.SubTotal=Number((this.getRoundedNumber(2*e.SubTotal)/2).toFixed(1));break;case 1:t=Math.pow(10,0),e.SubTotal=this.getRoundedNumber(e.SubTotal*t)/t;break;case 5:e.SubTotal=5*this.getRoundedNumber(e.SubTotal/5);break;case 10:e.SubTotal=10*this.getRoundedNumber(e.SubTotal/10)}e.RoundingFraction=e.SubTotal-r}}},{key:"getRoundedNumber",value:function(e){switch(this.settingobj.RoundingMethod){case 1:e=Math.ceil(e);break;case 2:e=Math.floor(e);break;case 3:e=Math.round(e)}return e}},{key:"checkCallCenter",value:function(e){var t;return(null==e?void 0:e.pointOfSale)&&(null===(t=null==e?void 0:e.pointOfSale)||void 0===t?void 0:t.IsCallCenter)&&(e.IsCallCenter=!0,e&&e.CustomerDocumentId&&e.CustomerAddressDocumentId?e.CallCenterBranch||$("#modal-Branches").modal("show"):(this.isDelivery=!0,$("#modal-40444").modal("show"))),e}},{key:"setCallCenterBranch",value:function(e,t){return e.CallCenterBranch=t.DocumentId,$("#modal-Branches").modal("hide"),e}},{key:"setProductPriceForMobileOrder",value:function(e,t){if(t||0===t){e.EditedPrice=Number(t),e.ProductPrice=Number(t),e.Product.Price=Number(t),e.Product.PriceChanged=!0;var r=this.allproductlist.find(function(t){return t.DocumentId==e.ProductDocumentId});r&&(r.PriceChanged=!0,r.Price=Number(t))}}},{key:"setProductQuantityForGame",value:function(e){var t,r,n,i=this;if(e.TableId&&(null===(t=this.halls)||void 0===t?void 0:t.length)){var o=null===(r=this.halls)||void 0===r?void 0:r.find(function(t){return t.Tables.some(function(t){return t.DocumentId===e.TableId})});o&&(null==o?void 0:o.ServeEntertainmentServices)&&(null===(n=e.OrderDetails)||void 0===n||n.forEach(function(e){if(e.StartTime&&e.EndTime){var t=Object(C.g)(e.StartTime,e.EndTime)/60;if(2!=(null==o?void 0:o.EntertainmentServiceTime))e.ProductQuantity=Math.ceil(t)/60;else{var r=15*Math.ceil(t/15);e.ProductQuantity=r/60}}e.TotalTime=i.getGameTime(e)}))}}},{key:"getGameTime",value:function(e){if(e.StartTime&&e.EndTime){var t=Object(C.g)(e.StartTime,e.EndTime)/60;return"".concat(Math.floor(t/60),"H / ").concat(Math.ceil(t%60),"M")}return""}},{key:"tableHasMinCharge",value:function(e){var t,r,n,i,o,a,u,s=null===(r=null===(t=this.minimumCharges[0])||void 0===t?void 0:t.Tables)||void 0===r?void 0:r.find(function(t){return t.DocumentId===e.TableId});if(s){var d=(null===(n=s.OrderTypesList)||void 0===n?void 0:n.length)?!(!(null===(i=s.OrderTypesList)||void 0===i?void 0:i.includes(e.OrderTypeDocumentId))||!s.ValuePerPerson):!!s.ValuePerPerson;return 4==(null===(o=e.OrderType)||void 0===o?void 0:o.Value)&&(null===(u=null===(a=this.orderSer)||void 0===a?void 0:a.settings)||void 0===u?void 0:u.UseMinimumCharge)&&e.MinimumChargeValue&&e.TableId&&d}return!1}},{key:"ApplySubTotalWithMinChargeValue",value:function(e){var t,r,n,i,o,a,u,s,d,l,c;(null===(t=e.OrderMasterTaxes)||void 0===t?void 0:t.length)||(e.OrderMasterTaxes=[]),e.SubTotal<e.MinimumChargeValue&&this.tableHasMinCharge(e)?1==e.HasMinimumCharge&&(e.MinimumChargeDifferance=e.MinimumChargeValue-e.SubTotal,e.MinimumChargeDifferance>0&&(null===(r=this.minimumCharges)||void 0===r?void 0:r.length)&&(null===(i=null===(n=this.minimumCharges[0])||void 0===n?void 0:n.Tax)||void 0===i?void 0:i.length)&&(null===(a=null===(o=this.minimumCharges[0])||void 0===o?void 0:o.Tax[0])||void 0===a?void 0:a.DocumentId)&&this.addTaxToOrderMasterTaxes(e),e.SubTotal=e.MinimumChargeValue,(null===(u=this.minimumCharges)||void 0===u?void 0:u.length)&&(null===(d=null===(s=this.minimumCharges[0])||void 0===s?void 0:s.Tax)||void 0===d?void 0:d.length)&&(null===(c=null===(l=this.minimumCharges[0])||void 0===l?void 0:l.Tax[0])||void 0===c?void 0:c.DocumentId)&&(e.minChargeTaxValue=e.OrderMasterTaxes.filter(function(e){return 2==e.ServiceTaxType})[0].TaxAmount),e.minChargeTaxValue&&(e.MinimumChargeDifferance=e.MinimumChargeDifferance-e.minChargeTaxValue),e.RemainigAmount=-1*e.MinimumChargeValue,e.OrderPayments[0].Amount=e.MinimumChargeValue):(e.SubTotal>e.MinimumChargeValue||!this.tableHasMinCharge(e))&&(e.MinimumChargeDifferance=0,e.minChargeTaxValue=0,e.HasMinimumCharge=!1,e.OrderMasterTaxes=e.OrderMasterTaxes.filter(function(e){return 2!=e.ServiceTaxType}))}},{key:"recalculateOrderObject",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this.checkWorkTimeFinished(),e.Serial||(e.Serial=S.Guid.create().toString()),e&&e.OrderDetails){this.handelCustomerPromos(e,!1),e.OrderDetails.filter(function(e){return!e.IsCancelled});for(var i=e.OrderDetails.length-1;i>=0;i--){e.IsDeliverectOrder&&this.setProductPriceForMobileOrder(e.OrderDetails[i],e.OrderDetails[i].RealPrice);var o=e.OrderDetails[i].Product;e.OrderDetails[i].UUID||(e.OrderDetails[i].UUID=S.Guid.create().toString()),o&&(this.recalculateSideDishesValue(e.OrderDetails[i]),this.checkProductVolumeAndSides(e.OrderDetails[i]),e.OrderDetails[i]=this.handlePromo(o,e.OrderDetails[i],e),e.OrderDetails[i]=this.handelProductDiscount(o,e.OrderDetails[i],e),e.OrderDetails[i]=this.handelProductTax(o,e.OrderDetails[i],e),this.setProductGroup(e.OrderDetails[i])),e.OrderDetails[i].Total=this.calculateOrderDetailTotal(e.OrderDetails[i],e)}this.handleDeliveryPriceOptions(e,!0),this.calculateTotals(e,t),this.ApplySubTotalWithMinChargeValue(e),e=this.getReportTranslationObj(e),this.updatePendingOrders(e)}return e=this.checkCallCenter(e),this.settingobj.IsUsingCustomerPriceDisplay&&(e.DispalyMode=2,this.orderSer.VFDDisplay(e).subscribe()),this.calculateRemainingAmount(e),this.handelFoodPlan(e,n),r?e:this.setOrderTypeDiscountValue(e)}},{key:"setOrderTypeDiscountValue",value:function(e){var t,r,n;if(2==(null===(t=e.OrderType)||void 0===t?void 0:t.DiscountType)&&(null===(r=e.OrderType)||void 0===r?void 0:r.Discount)>0){var i=null===(n=e.OrderType)||void 0===n?void 0:n.Discount;return e.Discount=e.DiscountVal=e.DiscountPer=0,this.calculateTotals(e,!1),e.DiscountPer=e.SubTotal>0?Number(i)/e.SubTotal*100:0,e.DiscountPer=e.DiscountPer>100?100:e.DiscountPer,e.Discount=e.DiscountPer,e.DiscountType="1",this.recalculateOrderObject(e,!0,!0)}return e}},{key:"addCustomPromoWithOrderDetail",value:function(){}},{key:"handelFoodPlan",value:function(e){var t,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.EmployeeDocumentId&&e.FoodPlanData&&!r&&(null===(t=e.FoodPlanData)||void 0===t?void 0:t.remainingAmount)&&(e.Discount=e.DiscountVal=e.DiscountPer=0,(e=this.recalculateOrderObject(e,!0,!1,!0)).Discount=e.NetTotal?e.FoodPlanData.remainingAmount/e.NetTotal*100:0,e.Discount=this.clamp(e.Discount,0,100),e.DiscountType="1",(e=this.recalculateOrderObject(e,!0,!1,!0)).FoodPlanDiscountAmount=e.DiscountAmount)}},{key:"setProductGroup",value:function(e){if(this.productgrouplist&&this.productgrouplist.length){var t=this.productgrouplist.find(function(t){return e.ProductGroupDocumentId&&t.DocumentId===e.ProductGroupDocumentId||e.ProductGroupId&&t.Id===e.ProductGroupId});t&&(e.ProductGroupId=t.Id,e.ProductGroupDocumentId=t.DocumentId,e.ProductGroupName=t.Name)}}},{key:"handleDeliveryPriceOptions",value:function(e,t){var r,n,i,o,a=!1;if(e.OrderType&&2==e.OrderType.Value)if(t){if(this.settingobj.IsDeliveryFreeForAll?(e.DeliveryPrice=0,e.DeliveryPersonDeliveryPrice=0):this.settingobj.IsDeliveryFixed?(e.DeliveryPrice=this.settingobj.FixedDeliveryPrice,e.DeliveryPersonDeliveryPrice=0):this.settingobj.IsDeliveryFreeForBigOrders&&e.SubTotal>=this.settingobj.BigOrdersSubTotal&&(e.DeliveryPrice=0,e.DeliveryPersonDeliveryPrice=0),(null===(r=this.settingobj)||void 0===r?void 0:r.IsDeliveryIncludedInRevenueAsPercentage)&&(null===(n=this.settingobj)||void 0===n?void 0:n.DeliveryIncludedPercentage)){var u=document.activeElement;if(!(null==u?void 0:u.name)||"RegionsDeliveryPrice"!=(null==u?void 0:u.name)){var s=(null!==(i=e.DeliveryPrice)&&void 0!==i?i:0)+(null!==(o=e.DeliveryPersonDeliveryPrice)&&void 0!==o?o:0);e.DeliveryPrice=s*(this.clamp(this.settingobj.DeliveryIncludedPercentage,1,100)/100),e.DeliveryPersonDeliveryPrice=s-e.DeliveryPrice}}}else this.settingobj.DeliveryMaxSubTotal&&0!=Number(this.settingobj.DeliveryMaxSubTotal)&&(e.SubTotal>=this.settingobj.DeliveryMinSubTotal&&e.SubTotal<=this.settingobj.DeliveryMaxSubTotal||(a=!0));return a}},{key:"calculateOrderPayments",value:function(e,t){var r=this.deepCopy(e.OrderPayments);if(!e.Reservation&&1===(null==r?void 0:r.length)&&r[0].Amount===this.totalForAllPay(e))return e;if(e.OrderPayments&&!t||(e.OrderPayments=[]),t||0==e.OrderPayments.length)if(e.FreePaymentCalculated&&r[0]&&r[0].PayTypeDocumentId){var n=this.orderPayTypelist.filter(function(e){return e.DocumentId==r[0].PayTypeDocumentId})[0];this.setOrderPayType(n||this.orderPayTypelist[0],e)}else if(e.OrderType&&(e.OrderType.OrderPayTypeDocumentId||e.OrderType.OrderPayTypeId)){var i=this.orderPayTypelist.filter(function(t){return e.OrderType.OrderPayTypeId&&t.Id==e.OrderType.OrderPayTypeId||e.OrderType.OrderPayTypeDocumentId&&t.DocumentId==e.OrderType.OrderPayTypeDocumentId})[0];this.setOrderPayType(i||this.orderPayTypelist[0],e)}else if(e.OrderType&&4==e.OrderType.Value&&e.OrderType.ForStaff){var o=this.orderPayTypelist.filter(function(e){return 20==e.PayType})[0];this.setOrderPayType(o||this.orderPayTypelist[0],e)}else if(e.Reservation&&e.PayedAmountReservation>e.SubTotal){var a=this.orderPayTypelist.filter(function(e){return 20==e.PayType})[0];this.setOrderPayType(a||this.orderPayTypelist[0],e)}else{var u=1===(null==r?void 0:r.length)?this.orderPayTypelist.find(function(e){return e.DocumentId==r[0].PayTypeDocumentId&&70!=e.PayType}):this.orderPayTypelist[0];this.setOrderPayType(null!=u?u:this.orderPayTypelist[0],e)}return e}},{key:"setReservationPayment",value:function(e){if(e.Reservation&&e.PayedAmountReservation>0){var t=this.orderPayTypelist.filter(function(e){return 20==e.PayType})[0];if(t){var r=new v.a;r.PayTypeId=t.Id,r.PayTypeDocumentId=t.DocumentId,r.PayTypeName=t.Name,r.Amount=e.PayedAmountReservation,r.PayAmount=e.PayedAmountReservation,r.ReservationPayment=!0,(null==e.OrderPayments||0==e.OrderPayments.length||-1==e.OrderPayments.findIndex(function(e){return r.PayTypeId&&e.PayTypeId==r.PayTypeId||e.PayTypeDocumentId==r.PayTypeDocumentId})&&0!=e.OrderPayments[e.OrderPayments.length-1].Amount)&&(e.OrderPayments.push(r),this.calculateRemainingAmount(e))}else this.toastr.info("Missing Credit Payment Types !"),this.router.navigateByUrl("/PayType")}return e}},{key:"setOrderPayType",value:function(e,t){var r,n,i,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(t.OrderPayments||(t.OrderPayments=[]),!(t.IntegrationSystem&&t.IntegrationSystem>0)){t.Reservation&&t.PayedAmountReservation>0&&(t=this.setReservationPayment(t)),e||(e=new f.a),t.TotalInsuranceAmount||(t.TotalInsuranceAmount=0);var a=new v.a;if(a.PayTypeId=e.Id?e.Id:null,a.PayTypeDocumentId=e.DocumentId,t.OrderPayTypeId=e.Id?e.Id:null,t.OrderPayTypeDocumentId=e.DocumentId,t.OrderPayTypeName=e.Name,a.PayTypeName=this.getTypeName(e),70==e.PayType&&(a.PayType=e.PayType),70===e.PayType&&t.RemainigAmount<0){var u=Math.abs(t.RemainigAmount)>(null===(r=this.selectedPointsCard)||void 0===r?void 0:r.Value)?null===(n=this.selectedPointsCard)||void 0===n?void 0:n.Value:Math.abs(t.RemainigAmount);u&&Object(C.d)(u)>5&&(u=parseFloat(u.toFixed(5))),a.Amount=u,a.PayAmount=u,t.PointsCountApplied=null===(i=this.selectedPointsCard)||void 0===i?void 0:i.PointsCount}else a.Amount=0;o&&(a.PayTypeName=o.Name,a.PaymentSystemDocumentId=o.PaymentSystemDocumentId),70!==e.PayType&&(a.Amount=null==t.OrderPayments||0==t.OrderPayments.length?t.SubTotal+t.DeliveryPersonDeliveryPrice+t.TotalInsuranceAmount:Number(t.RemainigAmount)>=0?0:-1*t.RemainigAmount),(!t.Reservation||t.PayedAmountReservation<t.SubTotal)&&(null==t.OrderPayments||0==t.OrderPayments.length||-1==t.OrderPayments.findIndex(function(e){return e.PayTypeDocumentId==a.PayTypeDocumentId})&&0!=t.OrderPayments[t.OrderPayments.length-1].Amount)&&(70===a.PayType?(t.OrderPayments.unshift(a),this.calculateRemainingAmount(t,Object(C.d)(t.SubTotal)>5),t.RemainigAmount<0&&this.setOrderPayType(this.defaultSelectedPayType,t)):t.OrderPayments.push(a),this.calculateRemainingAmount(t)),e.Percentage>0&&!t.FreePaymentCalculated?(t.Discount=e.Percentage,t.DiscountType="1",t.FreePaymentCalculated=!0,t=this.recalculateOrderObject(t,!0)):t.FreePaymentCalculated&&(t.FreePaymentCalculated=!1)}}},{key:"calculateRemainingAmount",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new h.a,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.totalOrderPayment=0,(null==t?void 0:t.RemainigAmount)||(t.RemainigAmount=0),(null==t?void 0:t.SubTotal)&&(null!=t.OrderPayments&&t.OrderPayments.forEach(function(t){e.totalOrderPayment+=t.PayAmount&&t.PayAmount>0?Number(t.PayAmount):0}),t.RemainigAmount=this.totalOrderPayment-(r?Number(t.SubTotal.toFixed(5)):t.SubTotal)-t.DeliveryPersonDeliveryPrice-t.TotalInsuranceAmount),0==t.SubTotal&&(t.TotalInsuranceAmount>0||t.TotalInsuranceAmount)&&(t.pointOfSale.PaymentButtonDirectly||(t.RemainigAmount=-1*(null==t?void 0:t.TotalInsuranceAmount)))}},{key:"validatePayment",value:function(e){var t,r,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e.OrderPayments&&e.OrderPayments.length&&!e.OrderPayments.some(function(e){return!e.PayTypeDocumentId})){if(e.Reservation&&e.PayedAmountReservation>0&&(null===(t=e.OrderPayments)||void 0===t?void 0:t.length)>1&&(null===(r=e.OrderPayments)||void 0===r||r.forEach(function(e){(null==e?void 0:e.Amount)&&!(null==e?void 0:e.PayAmount)&&(e.PayAmount=e.Amount)})),!(e.OrderPayments.length>1&&e.OrderPayments[e.OrderPayments.length-1].PayAmount<e.OrderPayments[e.OrderPayments.length-1].Amount||e.OrderPayments.length>1&&!e.OrderPayments[e.OrderPayments.length-1].PayAmount)){if(100!=e.Discount||"1"!=e.DiscountType){if(!e.OrderPayments||0==e.OrderPayments.length)return this.toastr.warning(this.translate.instant("messages.paymentRequired")),!1;if(e.OrderPayments.filter(function(e){return!e.PayTypeDocumentId})[0])return this.toastr.warning(this.translate.instant("messages.paymentRequired")),e=this.recalculateOrderObject(e),!1;if(e.OrderPayments.filter(function(e){return!e.Amount||0==e.Amount})[0]&&e.OrderDetails.filter(function(e){return e.IsCancelled}).length<e.OrderDetails.length&&e.SubTotal>0){var i=e.OrderPayments.filter(function(e){return!e.Amount||0==e.Amount})[0],o=e.OrderPayments.indexOf(i);return this.toastr.warning(this.translate.instant("messages.PaymentAmountCannotbeZero")),this.setFocusById("PayAmount"+o),!1}var a=e.OrderPayments.map(function(e){return Number(e.Amount)}).reduce(function(e,t){return e+t},0),u=Number(e.SubTotal-a);if(1==e.IsMobileOrder||1==e.IsCallCenter)return!0;if(u>.01)return this.toastr.warning(this.translate.instant("messages.OrderPaymentMustbeGreaterthanorequaltototal")),!1;if(n&&this.settingobj.PreventClosingWithoutFullPayment&&e.OrderPayments.filter(function(e){return!e.PayAmount||0==e.PayAmount})[0]&&e.OrderPayments.filter(function(e){return e.Amount>0})[0]){var s=e.OrderPayments.filter(function(e){return!e.PayAmount||0==e.PayAmount})[0],d=e.OrderPayments.indexOf(s);return this.toastr.warning(this.translate.instant("messages.PaymentAmountCannotbeZero")),this.setFocusById("PayAmount"+d),!1}if(e.Reservation&&e.PayedAmountReservation>0&&!this.checkCreditPayment(e))return this.toastr.warning(this.translate.instant("messages.MustAddCreditPayment")),!1;if(e.pointOfSale&&e.pointOfSale.IsCallCenter&&(!e.CustomerDocumentId||!e.CustomerAddressDocumentId||!e.CallCenterBranch))return e.CustomerDocumentId&&e.CustomerAddressDocumentId||this.toastr.info(this.translate.instant("messages.MustSelectCustomer")),e.CallCenterBranch||this.toastr.info(this.translate.instant("Shared.BranchName")+"!"),e=this.checkCallCenter(e),!1;if(e.OtelPrimoRoomNo>0&&!this.checkCreditPayment(e))return this.toastr.warning(this.translate.instant("messages.MustAddCreditPayment")),!1;var l=this.orderPayTypelist.filter(function(e){return e.NoteIsRequired}).map(function(e){return e.DocumentId});if(null==l?void 0:l.length){var c=e.OrderPayments.find(function(e){return l.includes(e.PayTypeDocumentId)&&!e.Note});if(c)return this.toastr.warning(this.translate.instant("messages.NoteIsRequiredForPayment")+c.PayTypeName),!1}}return!((e.paymentErrorFired||1==e.OrderPayments.length&&(e.OrderPayTypeId&&e.OrderPayments[0].PayTypeId!=e.OrderPayTypeId||e.OrderPayTypeDocumentId&&e.OrderPayments[0].PayTypeDocumentId!=e.OrderPayTypeDocumentId))&&!e.IsMobileOrder&&!e.IsCallCenter&&(e.OrderPayments=[],e.paymentErrorFired=!0,this.toastr.warning(this.translate.instant("messages.PleaseMakeSureOfOrderPayment")),1))}this.toastr.warning(this.translate.instant("messages.PleaseInsertPayAmountForEachPayment"))}else this.toastr.warning(this.translate.instant("messages.PleaseInsertPayAmountForEachPayment"))}},{key:"getName",value:function(e){var t,r,n,i,o,a,u;return e?e.ProductProperties&&e.ProductProperties.Name&&!e.VolumeId&&!e.VolumeDocumentId?null!==(t=e.ProductProperties.Name)&&void 0!==t?t:"":this.defaultLanguage&&this.settingobj&&this.currentUserLanguage?this.settingobj.ShowBothNameAndForeignName&&e.ForiegnName&&""!=e.ForiegnName?(null!==(r=e.Name)&&void 0!==r?r:"")+" , "+(null!==(n=e.ForiegnName)&&void 0!==n?n:""):this.settingobj.NamesOfProductsBasedOnMainUserLang?!this.currentUserLanguage.includes(this.defaultLanguage)&&e.ForiegnName&&""!=e.ForiegnName?null!==(i=e.ForiegnName)&&void 0!==i?i:"":null!==(o=e.Name)&&void 0!==o?o:"":null!==(a=e.Name)&&void 0!==a?a:"":null!==(u=e.Name)&&void 0!==u?u:"":""}},{key:"getNameForProduct",value:function(e){var t,r="";return(null===(t=this.settingobj)||void 0===t?void 0:t.ShowProductCodeWithNameInOrderScreen)&&e.ProductNumber&&(r="-"+e.ProductNumber),"".concat(this.getName(e)).concat(r)}},{key:"getTypeOfName",value:function(){return this.defaultLanguage&&this.settingobj&&this.currentUserLanguage&&this.settingobj.NamesOfProductsBasedOnMainUserLang?this.currentUserLanguage.includes(this.defaultLanguage)?1:2:1}},{key:"getTypeName",value:function(e){var t,r,n,i,o,a;return e?this.defaultLanguage&&this.settingobj&&this.currentUserLanguage?this.settingobj.ShowBothNameAndForeignName&&e.ForeignName&&""!=e.ForeignName?(null!==(t=e.Name)&&void 0!==t?t:"")+" , "+(null!==(r=e.ForeignName)&&void 0!==r?r:""):this.settingobj.NamesOfProductsBasedOnMainUserLang?!this.currentUserLanguage.includes(this.defaultLanguage)&&e.ForeignName&&""!=e.ForeignName?null!==(n=e.ForeignName)&&void 0!==n?n:"":null!==(i=e.Name)&&void 0!==i?i:"":null!==(o=e.Name)&&void 0!==o?o:"":null!==(a=e.Name)&&void 0!==a?a:"":""}},{key:"checkCreditPayment",value:function(e){if(e&&e.OrderPayments){var t=this.orderPayTypelist.filter(function(e){return 20===e.PayType&&e.Id}).map(function(e){return e.Id}),r=this.orderPayTypelist.filter(function(e){return 20===e.PayType&&e.DocumentId}).map(function(e){return e.DocumentId});return!!e.OrderPayments.find(function(e){return t.includes(e.PayTypeId)||r.includes(e.PayTypeDocumentId)})}return!1}},{key:"checkAvailableQuantityBeforeSave",value:function(e){var t=this;return new Promise(function(r){t.orderSer.checkAvailableQuantityBeforeSave(e).subscribe(function(e){return Object(d.a)(t,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(r(!0),!0));case 1:case"end":return e.stop()}},e)}))},function(e){return t.handeExeptionError(e.error),r(!1),!1})})}},{key:"closeAsync",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.showLoader(r),this.updatePendingOrders(e,!0),new Promise(function(n){e.DocumentId?t.orderSer.UpdateOrder(e).subscribe(function(i){return Object(d.a)(t,void 0,void 0,regeneratorRuntime.mark(function t(){var o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:this.showSuccess(r),i&&1==i.Item1?(this.toastr.success(this.toastrMessage.GlobalMessages(i.Item1),"Order"),(null===(o=this.settingobj)||void 0===o?void 0:o.UseStocksAndPurchase)&&this.orderSer.UpdateItemsQuantities(e.DocumentId).subscribe(),i.Item2&&this.PrintToPrinterFromCloud(i.Item2,e.LanguageOptions)):(this.showFaild(r),this.toastr.error(this.toastrMessage.GlobalMessages(i),"Order")),n(i);case 1:case"end":return t.stop()}},t,this)}))},function(e){t.showFaild(r),t.handeExeptionError(e.error),n(e)}):t.orderSer.CloseOrder(e).subscribe({next:function(i){var o;t.showSuccess(r),i&&i.Item4&&(null===(o=t.settingobj)||void 0===o?void 0:o.UseStocksAndPurchase)&&t.orderSer.UpdateItemsQuantities(i.Item4).subscribe(),i&&!i.Item1?t.toastr.success(t.toastrMessage.GlobalMessages(i),"Order"):1==i.Item1?(e.IntegrationSystem>0&&t.updateOrderStatus(0,e.ReferenceCode,"",e),t.toastr.success(t.toastrMessage.GlobalMessages(i.Item1),"Order"),1==i.Item2?t.toastr.info("Printed Successfully","Order"):t.toastr.error("Something wrong hapeens while printing","Order"),i.Item3&&t.PrintToPrinterFromCloud(i.Item3,e.LanguageOptions)):(t.showFaild(r),t.toastr.error(t.toastrMessage.GlobalMessages(i.Item1),"Order")),n(i)},error:function(e){t.showFaild(r),t.handeExeptionError(e.error),n(e)}})})}},{key:"checkIsOnlinePay",value:function(e,t){if(e&&e.UsePaymentDevices&&e.PaymentDevices.length>0&&t.Paid){var r=e.PaymentDevices.map(function(e){return e.PayTypeDocumentId});return t.OrderPayments.filter(function(e){return r.includes(e.PayTypeDocumentId)}).length>0}return!1}},{key:"showLoader",value:function(e){this.errorForPaymentDevice=!1,e&&(this.requestStarted=!1,P.a.fire({title:this.translate.instant("setting.Connecting"),html:this.translate.instant("setting.Pleasewait"),timerProgressBar:!0,allowOutsideClick:!1,showConfirmButton:!1,allowEscapeKey:!1,didOpen:function(){P.a.showLoading()}}))}},{key:"showSuccess",value:function(e){this.errorInSaveOrder=!1,e&&(P.a.close(),P.a.fire({title:this.translate.instant("setting.Success"),text:this.translate.instant("Shared.Done"),icon:"success",showConfirmButton:!1,allowOutsideClick:!1,allowEscapeKey:!1,showCancelButton:!0,cancelButtonText:this.translate.instant("Shared.Cancel")}).then(function(e){}))}},{key:"showFaild",value:function(e){this.errorInSaveOrder=!0,e&&(this.errorForPaymentDevice=!0,P.a.close(),P.a.fire({title:"",text:this.translate.instant("setting.FaildConnect")+"!",icon:"error",showConfirmButton:!1,allowOutsideClick:!1,allowEscapeKey:!1,showCancelButton:!0,cancelButtonText:this.translate.instant("Shared.Cancel")}).then(function(e){}))}},{key:"PrintToPrinterFromCloud",value:function(e,t){if(e.Reports&&e.Reports.length||e.OrderDetailPrinters&&e.OrderDetailPrinters.length){var r=this.deepCopy(t);r.ReportsJson=void 0,r.JsonLangFile=this.getJsonLangforCloud();var n=localStorage.getItem("token"),i=localStorage.getItem("TenantId"),o=localStorage.getItem("PointOfSaleDocumentId"),a={Url:this.orderSer.common.rooturl.toString(),Token:n,LanguageOptions:r,TenantId:i,PointOfSaleDocumentId:o,Reports:e.Reports,OrderDetailPrinters:e.OrderDetailPrinters};this.orderSer.CompressGZip(JSON.stringify(a)).subscribe(function(e){e&&e.json&&(location.href="PrintToPrinter:"+e.json)})}}},{key:"handeExeptionError",value:function(e){var t="";if(e.errors&&e.title)this.toastr.error(e.title),t=e.title;else try{var r=e.indexOf(" at "),n=e.substr(0,r);if(t=n,n.includes("UnAvailableQuantity")){var i=n.indexOf("UnAvailableQuantity"),o=n.substr(i+"UnAvailableQuantity".length);this.toastr.info(this.translate.instant("messages.NoAvailableQuantity")+" "+o,"Order")}else t.toLowerCase().includes("validate order")||this.toastr.error(n,"Order")}catch(e){this.toastr.error(e),t=e}if("string"==typeof t&&(t.toLowerCase().includes("validate order")||t.toLowerCase().includes("shiftbeforedo"))){this.requestStarted=!1,this.orderSer.stopLoaderOnError=!0,t.toLowerCase().includes("shiftbeforedo")||this.handelValidateOrderExeptionMessages(t);var a=document.getElementById("preloader-wrap");throw a&&(a.style.display="none"),new Error(t)}}},{key:"handelValidateOrderExeptionMessages",value:function(e){e.toLowerCase().includes("please add setting to printer paths")?this.toastr.warning(this.translate.instant("messages.pleaseaddsettingtoprinterpaths")):e.toLowerCase().includes("make sure your tax printer is connected")?this.toastr.warning(this.translate.instant("messages.Makesureyourtaxprinterisconnected")):this.toastr.warning(e)}},{key:"handelCustomPromo",value:function(e,t,r){var n,i,o;this.freeProducts=[];var a=e.Promos.map(function(e){return e.PromoProducts}).reduce(function(e,t){return e.concat(t)},[]);if(a&&a.length>0){a=a.filter(function(t){return t.TakeProductDocumentId==e.DocumentId});var u=e.VolumeDocumentId||(null==t?void 0:t.VolumeDocumentId);(null==a?void 0:a.length)&&u&&(a=a.filter(function(t){return t.TakeProductVolumeDocumentId==u&&t.TakeProductDocumentId==e.DocumentId}));var s=a[0];if(s&&((null===(n=s.GetProducts)||void 0===n?void 0:n.length)>0||(null===(i=null==s?void 0:s.PromoCustomProductDetails)||void 0===i?void 0:i.length)>0)){s.TakeProductQuantity||(s.TakeProductQuantity=1);var d=Number(t.ProductQuantity)/Number(s.TakeProductQuantity);if(Number(d)>0&&t.ProductQuantity===s.TakeProductQuantity){if(this.allproductlist&&this.allproductlist.length>0){if(s&&(null===(o=null==s?void 0:s.PromoCustomProductDetails)||void 0===o?void 0:o.length)){var l=null==s?void 0:s.PromoCustomProductDetails.map(function(e){return e.GetProductDocumentId});this.freeProducts=this.deepCopy(this.allproductlist.filter(function(e){return l.includes(e.DocumentId)}))}else this.freeProducts=this.deepCopy(this.allproductlist.filter(function(e){return s.GetProducts.map(function(e){return e.GetProductDocumentId}).includes(e.DocumentId)}));this.freeProducts.forEach(function(e){e.Disabled||(e.Disabled=!1),e.FreeChecked||(e.FreeChecked=!1)})}t.IsParentPromo?this.freeProducts.forEach(function(e){var n=r.OrderDetails.findIndex(function(r){return r.ProductDocumentId==e.DocumentId&&r.ProductIndex==t.ProductIndex&&r.IsPromo});-1!=n&&(r.OrderDetails[n].ProductQuantity=s.GetProductQuantity*d,r.OrderDetails[n].PromoProductName=t.ProductName)}):(t.IsParentPromo=!0,t.IsPromo||(this.freeobj={promoProduct:s,orderDetail:t,dividForSameProduct:d,orderobj:r},1===this.freeProducts.length?this.selectFreeProducts(!0,0):(this.freeProductsSelectionLimit=s.GetProductQuantity,$("#modal-CustomPromo").modal("show"))))}}}}},{key:"printOrderObj",value:function(e){var t=this;e.OrderDetails.some(function(e){return e.StartTime&&!e.EndTime})?this.toastr.warning(this.translate.instant("messages.PleaseCloseOpendGame")):(this.isPrinting=!0,this.orderSer.PrintOrder(e).subscribe(function(r){return Object(d.a)(t,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:r&&1==r.Item1?(this.toastr.success(this.toastrMessage.GlobalMessages(r.Item1),"Order"),r.Item2&&this.PrintToPrinterFromCloud(r.Item2,e.LanguageOptions),e.PrintCount?e.PrintCount++:e.PrintCount=1):this.toastr.error(this.toastrMessage.GlobalMessages(r),"Order"),this.isPrinting=!1;case 1:case"end":return t.stop()}},t,this)}))},function(e){t.toastr.error(t.translate.instant("messages.Somethingwronghapeenswhileprinting")),t.isPrinting=!1}))}},{key:"PrintPreviewOrder",value:function(e){var t=this;this.isPrinting=!0,e.LanguageOptions||this.getReportTranslationObj(e),this.orderSer.PrintPreviewOrder(e).subscribe(function(e){return Object(d.a)(t,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e&&this.toastr.success(this.toastrMessage.GlobalMessages(e)),this.isPrinting=!1;case 1:case"end":return t.stop()}},t,this)}))},function(e){t.toastr.error(t.translate.instant("messages.Somethingwronghapeenswhileprinting")),t.isPrinting=!1})}},{key:"printMultiOrders",value:function(e){var t=this;e.forEach(function(e){t.PrintPreviewOrder(e)})}},{key:"permittedPrint",value:function(e){if(this.isAdmin)return!0;var t=this.validationList.CanPrint;return(!t||e.PrintCount>0)&&(t=this.validationList.CanPrintMoreThanOne),t}},{key:"printOrder",value:function(e,t){var r,n=this;if(e.OrderDetails.some(function(e){return e.StartTime&&!e.EndTime}))this.toastr.warning(this.translate.instant("messages.PleaseCloseOpendGame"));else if((null===(r=this.settingobj)||void 0===r?void 0:r.UseMinimumCharge)&&e.MinimumChargeValue&&e.MinimumChargeValue>e.SubTotal)this.toastr.warning(this.translate.instant("messages.MinimumChargeValueShouldBe"));else{var i=!1;if(1==t){if(e.OrderDetails.forEach(function(e){0==e.Printed||null==e.Printed?(n.toastr.warning(n.translate.instant("messages.paymentprintorderwarning")),i=!1):i=!0}),0==i)return;return this.printOrderObj(e),!1}this.printOrderObj(e)}}},{key:"getValidationOptions",value:function(){return this.validationList={CanSuspendOrder:!1,CanAddExtraService:!1,CanAddDiscount:!1,CanAddTips:!1,CanAddCustomer:!1,CanViewPayment:!1,CanPrint:!1,CanPrintMoreThanOne:!1,CanSplitOrder:!1,CanSplitOrderAfterPrint:!1,CanSplitReceipt:!1,CanChangeTable:!1,CanViewCachierOperations:!1,CanViewSales:!1,CanViewClosedOrders:!1,CanCancelOrder:!1,CanCancelOrderAfterPrint:!1,CanCancelOrderAfterOrderPreparationTime:!1,CanChangeEndOfDayDate:!1,CanChangeDeliveryPrice:!1,CanChangeInsurancePrice:!1,CanChangeProductProperties:!1,CanAddDiscountForDetail:!1,CanCloseWithoutPrint:!1,CanAddCreditCustomer:!1,CanNotEditOrderForAnotherUser:!1,CanEditDeliveryInfoAfterSave:!1,CanViewTotalOfOrdersInHall:!1,CannotAddAndEditHallsAndTables:!1,VerifiedOrderByPinBeforeSave:!1,CanAddCancelReasonFromOrder:!1,CanEditTheCaptainInOrder:!1,CanEditTheWaiterInOrder:!1,CanEditPersonsCountAfterSave:!1,CanCancelService:!1,CanViewTotalLastOrders:!1,CanChangeQuantityAfterSaveForWeightedProduct:!1},this.clone(this.validationList)}},{key:"showCustomerPopUp",value:function(e,t){var r=this;e.DocumentId&&!t.CanEditDeliveryInfoAfterSave?this.toastr.info(this.translate.instant("messages.CanNotEditDeliveryInfoAfterSave")):this.orderSer.closeOrderFromPayment?(setTimeout(function(){r.showDeliveryModal()},200),this.orderSer.closeOrderFromPayment=!1):this.showDeliveryModal()}},{key:"showDeliveryModal",value:function(){var e=this;$("#modal-40444").modal("show"),setTimeout(function(){e.setFocusById("search_PhoneNumber")},300)}},{key:"CheckISGrantedTo",value:function(e,t){var r=!1;return t.forEach(function(t){t.POSUserRoleOptions.forEach(function(t){if(t.Name==e&&t.IsGranted)return r=!0,!0})}),0!=r}},{key:"grantOptionsForUser",value:function(e,t,r){var n=this,i=this.clone(t);return Object.keys(i).forEach(e?function(e){i[e]=!0}:function(e){i[e]=n.CheckISGrantedTo(e,r)}),i}},{key:"routIfMissingData",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";switch(e){case"pointofsale":this.toastr.info(this.translate.instant("messages.MissingPointofsale")),this.router.navigateByUrl("/pointofsale");break;case"producttype":this.toastr.info("Missing Products !"),this.router.navigateByUrl("/serversync");break;case"setting":this.toastr.info("Missing settings !"),this.router.navigateByUrl("/POSsettings");break;case"ordertype":this.toastr.info("Missing OrderType !"),this.router.navigateByUrl("/serversync");break;case"orderpaytype":this.toastr.info("Missing OrderPayTypes !"),this.router.navigateByUrl("/serversync");break;case"pin":this.toastr.info(this.translate.instant("messages.MustPin")),this.router.navigateByUrl("/home");case"user":this.toastr.info(this.translate.instant("messages.MustCaptain")),setTimeout(function(){t.router.navigateByUrl("/home")},100);break;case"workTime":this.toastr.info(this.translate.instant(r||"messages.MustLinkUserWithShift")),setTimeout(function(){t.router.navigateByUrl("/home")},100);break;case"admin":this.toastr.info(this.translate.instant("messages.AdminAccessDenied")),setTimeout(function(){t.router.navigateByUrl("/home")},100);break;default:this.router.navigateByUrl("/home")}}},{key:"continueAfterPin",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;switch(e){case"CanCancelOrder":case"CanCancelOrderAfterPrint":$("#modal-Cancel").modal("show");break;case"CanSplitReceipt":this.splitReceipt();break;case"CanSplitOrder":this.splitOrChangeOrder(!0);break;case"CanChangeTable":this.splitOrChangeOrder(!1);break;case"ReturnOrder":this.router.navigateByUrl("/returnorder",{state:{PinUserId:this.orderobj.PinUserId}});break;case"CanPrintMoreThanOne":case"CanPrint":this.printOrder(this.orderobj),null==t||t.ClearOrderModel(),null==t||t.clearSuggestions();break;case"CanCancelOrderAfterOrderPreparationTime":null==t||t.openCancelOrder()}}},{key:"handelDriverSettings",value:function(e){return e.Driver&&e.DriverDocumentId&&e.DeliveryPrice>0&&(e.DeliveryPersonDeliveryPrice||(e.DeliveryPersonDeliveryPrice=0),e.DeliveryPrice||(e.DeliveryPrice=0),e.Driver.NotIncludedInTotal?(e.DeliveryPersonDeliveryPrice+=Number(e.DeliveryPrice),e.SubTotal-=Number(e.DeliveryPrice),e.DeliveryPrice=0):e.Driver.FixedDeliveryPersonAmount&&e.Driver.DriverFixedAmount>0&&(e.DeliveryPersonDeliveryPrice+=Number(e.Driver.DriverFixedAmount),e.SubTotal-=Number(e.Driver.DriverFixedAmount),e.DeliveryPrice-=Number(e.Driver.DriverFixedAmount))),e}},{key:"PrintOrderWithDataSet",value:function(e){var t=this,r=this.clone(e);this.orderSer.PrintOrderWithDataSet({Order:r,IsA4:!1}).subscribe(function(e){try{t.reprtresult=null==e?void 0:e.report,t.orderToPrint=null==e?void 0:e.orderToPrint,t.report.loadDocument(t.reprtresult),t.report.renderAsync();var r=new Stimulsoft.Report.Export.StiHtmlExportSettings,n=new Stimulsoft.Report.Export.StiHtmlExportService,i=new Stimulsoft.System.IO.TextWriter,o=new Stimulsoft.Report.Export.StiHtmlTextWriter(i);n.exportTo(t.report,o,r);var a=document.getElementById("StimulsoftId");a&&(a.innerHTML=i.getStringBuilder().toString())}catch(u){}},function(e){t.handeExeptionError(e.error)})}},{key:"PrintPerview",value:function(e){var t=this;if(!e.OrderDetails.some(function(e){return e.StartTime&&!e.EndTime})){var r=!1;return e.OrderDetails.forEach(function(e){0==e.Printed||null==e.Printed?(t.toastr.warning(t.translate.instant("messages.paymentprintorderwarning")),r=!1):r=!0}),0!=r?(this.orderSer.PrintOrderWithDataSet({Order:e,IsA4:!0}).subscribe(function(e){t.reprtresult=null==e?void 0:e.report,t.report.loadDocument(t.reprtresult),t.report.renderAsync();var r=new Stimulsoft.Report.Export.StiHtmlExportSettings,n=new Stimulsoft.Report.Export.StiHtmlExportService,i=new Stimulsoft.System.IO.TextWriter,o=new Stimulsoft.Report.Export.StiHtmlTextWriter(i);n.exportTo(t.report,o,r);var a=document.createElement("iframe");a.name="frame1",a.style.position="absolute",a.style.top="-1000000px",document.body.appendChild(a);var u=a.contentDocument||a.contentWindow.document;return u.open(),u.write("</head><body>"),u.write(i.getStringBuilder().toString()),u.write("</body></html>"),u.close(),setTimeout(function(){window.frames.frame1.focus(),window.frames.frame1.print(),document.body.removeChild(a)},500),!1},function(e){t.handeExeptionError(e.error)}),!1):void 0}this.toastr.warning(this.translate.instant("messages.PleaseCloseOpendGame"))}},{key:"UnselectCustomer",value:function(e){return e.DeliveryPrice=0,e.DeliveryPersonDeliveryPrice=0,e.DeliveryNetPrice=0,e.CustomerDocumentId=void 0,e.CustomerId=void 0,e.CustomerAddressDocumentId=void 0,e.CustomerName=void 0,e.CustomerPhone=void 0,e.Customer=new g.a,e.CustomerAddress=new p.a,e}},{key:"updateOrderStatus",value:function(e,t,r){var n=this,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return new Promise(function(o){var a=JSON.parse(localStorage.getItem("clickedStatusList"));a||(a=[]);var u=a.filter(function(e){return e.OrderId==t})[0];u&&((new Date).getTime(),new Date(u.Date).getTime()),n.orderSer.updateOrderStatus({OrderStates:e,OrderId:t,Reason:null==r?void 0:r.Name,ReasonId:null==r?void 0:r.Id,ItemIdList:null==r?void 0:r.ItemIdList,Order:i,Integration:i.IntegrationSystem}).subscribe({next:function(e){n.toastr.success(n.toastrMessage.GlobalMessages(e)),o(!0)},error:function(e){var t;n.toastr.error(null===(t=null==e?void 0:e.error)||void 0===t?void 0:t.Message),o(!1)}}),$("#modal-YemekSepeti").modal("hide"),u?u.Date=new Date:a.push({OrderId:t,Date:new Date}),localStorage.setItem("clickedStatusList",JSON.stringify(a))})}},{key:"getReportTranslationObj",value:function(e){var t,r;this.settingobj.CustomerReceiptReportLanguage1>0&&(t=this.getJsonLang(this.settingobj.CustomerReceiptReportLanguage1)),this.settingobj.CustomerReceiptReportLanguage2>0&&(r=this.getJsonLang(this.settingobj.CustomerReceiptReportLanguage2));var n=Object.keys(x.a),i=this.clone(x.a);n.forEach(function(e){t&&(i[e]=t[e]),r&&(i[e]+="\n"+r[e])});var o="ar";return 1==this.settingobj.ReportDirection&&(o="ar"),2==this.settingobj.ReportDirection&&(o="en"),e.LanguageOptions={CurrentUserLang:o,ReportsJson:i},e}},{key:"getJsonLangforCloud",value:function(){var e="en.json";switch(this.settingobj.CustomerReceiptReportLanguage1){case 2:e="ar.json";break;case 3:e="tu.json";break;case 4:e="fr.json"}return window.location.href.replace("order",""),e}},{key:"getJsonLang",value:function(e){switch(e){case 1:this.reportsJson=I.a;break;case 2:this.reportsJson=x.a;break;case 3:this.reportsJson=O.a;break;case 4:this.reportsJson=b.a;break;default:this.reportsJson=I.a}return this.reportsJson}},{key:"selectFreeProducts",value:function(e,t){var r=this;if(e){if(!1===this.freeProducts[t].FreeChecked&&(this.freeOrderDetail=new c.a,this.freeOrderDetails||(this.freeOrderDetails=[]),this.freeProducts[t].FreeChecked=e,this.selectedFreeProducts.push(this.freeProducts[t]),this.selectedFreeProducts.forEach(function(e){var t,n,i,o,a,u,s,d,l,c,m,h,T;if(e.FreeChecked){if(r.freeOrderDetail.PromoProductName=r.freeobj.orderDetail.ProductName,r.freeOrderDetail.IsPromo=!0,r.freeOrderDetail.ProductId=e.Id,r.freeobj.orderDetail.ProductIndex||0==r.freeobj.orderDetail.ProductIndex||(r.freeobj.orderDetail.ProductIndex=e.orderobj.OrderDetails.length),r.freeOrderDetail.ProductIndex=r.freeobj.orderDetail.ProductIndex,r.freeOrderDetail.ProductDocumentId=e.DocumentId,r.freeOrderDetail.ProductGroupDocumentId=e.ProductGroupDocumentId,r.freeOrderDetail.ProductGroupId=e.ProductGroupId,r.freeOrderDetail.ProductName=r.getName(e),r.freeOrderDetail.Product=r.deepCopy(e),(null===(i=null===(n=null===(t=r.freeobj)||void 0===t?void 0:t.promoProduct)||void 0===n?void 0:n.GetProducts)||void 0===i?void 0:i.length)&&(r.freeOrderDetail.VolumeDocumentId=null===(s=null===(u=null===(a=null===(o=r.freeobj)||void 0===o?void 0:o.promoProduct)||void 0===a?void 0:a.GetProducts)||void 0===u?void 0:u.find(function(t){return t.GetProductDocumentId==e.DocumentId}))||void 0===s?void 0:s.GetProductVolumeDocumentId,r.setFreeDetailVolume(r.freeOrderDetail.Product)),r.freeOrderDetail.ProductPrice=0,r.freeOrderDetail.Product.Price=0,null===(c=null===(l=null===(d=r.freeobj)||void 0===d?void 0:d.promoProduct)||void 0===l?void 0:l.PromoCustomProductDetails)||void 0===c?void 0:c.length){var f=null===(T=null===(h=null===(m=r.freeobj)||void 0===m?void 0:m.promoProduct)||void 0===h?void 0:h.PromoCustomProductDetails)||void 0===T?void 0:T.find(function(t){return t.GetProductDocumentId==e.DocumentId});r.freeOrderDetail.VolumeDocumentId=null==f?void 0:f.GetProductVolumeDocumentId;var v=r.setFreeDetailVolume(r.freeOrderDetail.Product);if(f&&f.NewPrice&&(r.freeOrderDetail.ProductPrice=f.NewPrice,r.freeOrderDetail.Product.Price=f.NewPrice,r.freeOrderDetail.DiscountPercentage=0),f&&f.DiscountPercentage){var D=e.Price;if(r.freeOrderDetail.VolumeDocumentId&&v){var y=e.ProductVolumes.find(function(e){return v.DocumentId&&v.DocumentId==e.VolumeDocumentId||v.VolumeId&&v.VolumeId==e.VolumeId});y&&(D=y.Price)}r.freeOrderDetail.ProductPrice=D,r.freeOrderDetail.Product.Price=D,r.freeOrderDetail.DiscountPercentage=f.DiscountPercentage}}r.selectedFreeProducts.length>1?(r.freeOrderDetail.ProductQuantity=1,r.freeOrderDetails.forEach(function(e){e.ProductQuantity=1})):r.freeOrderDetail.ProductQuantity=r.freeobj.promoProduct.GetProductQuantity}}),this.freeOrderDetails.push(this.freeOrderDetail),1===this.freeProducts.length))return void this.confirmFreeProductsModel()}else{this.freeProducts[t].FreeChecked=e;var n=this.selectedFreeProducts.findIndex(function(e){return e.DocumentId===r.freeProducts[t].DocumentId});this.selectedFreeProducts.splice(n,1);var i=this.freeOrderDetails.findIndex(function(e){return e.ProductDocumentId===r.freeProducts[t].DocumentId});this.freeOrderDetails.splice(i,1),1===this.selectedFreeProducts.length&&1===this.freeOrderDetails.length&&(this.freeOrderDetails[0].ProductQuantity=this.freeobj.promoProduct.GetProductQuantity)}(this.freeobj.orderDetail.VolumeDocumentId&&this.freeobj.orderDetail.VolumeDocumentId.length>1||this.freeobj.orderDetail.VolumeFerpCode&&this.freeobj.orderDetail.VolumeFerpCode.length>1||this.freeobj.orderDetail.VolumeId)&&this.confirmFreeProductsModel()}},{key:"setFreeDetailVolume",value:function(e){var t,r,n,i,o=this;if(this.freeOrderDetail.VolumeDocumentId){var a=null===(t=this.volumes)||void 0===t?void 0:t.find(function(e){return e.DocumentId==o.freeOrderDetail.VolumeDocumentId});return a&&(this.freeOrderDetail.VolumeId=a.Id,this.freeOrderDetail.ProductVolumName=this.getName(a),(null===(r=this.settingobj)||void 0===r?void 0:r.ShowVolumeAsProduct)&&(e.Name=this.freeOrderDetail.ProductName+" ".concat(null!==(i=null===(n=this.settingobj)||void 0===n?void 0:n.VolumeAndProductNameSeparatorCharacter)&&void 0!==i?i:"/"," ")+this.freeOrderDetail.ProductVolumName)),a}return null}},{key:"confirmFreeProductsModel",value:function(){var e;(e=this.freeobj.orderobj.OrderDetails).push.apply(e,t(this.freeOrderDetails)),$("#modal-CustomPromo").modal("hide"),this.freeProducts=[],this.freeobj={},this.freeOrderDetails=[],this.freeOrderDetail=new c.a,this.selectedFreeProducts=[],this.freeobj.orderobj&&(this.freeobj.orderobj.OrderDetails=[]),this.orderobj=this.recalculateOrderObject(this.orderobj)}},{key:"closeFreeProductsModel",value:function(){$("#modal-CustomPromo").modal("hide"),this.freeProducts=[],this.freeobj={},this.freeOrderDetails=[],this.freeOrderDetail=new c.a,this.selectedFreeProducts=[],this.freeobj.orderobj&&(this.freeobj.orderobj.OrderDetails=[])}},{key:"getMaxDiscountForUser",value:function(e,t,r,n){var i=100;if(!e){var o=r.map(function(e){return e.POSUserRoleOptions}),a=[];o.forEach(function(e){var r=e.filter(function(e){return e.Name==t&&e.IsGranted})[0];r&&a.push(r)});var u=[];a&&a.length>0?u=a.map(function(e){return e.MaxDiscountValue}):n[t]&&u.push(i);var s=Math.max.apply(null,u);i=s>0?s:0}return i}},{key:"checkIfPersonSelected",value:function(e,t,r,n){if(n){if(r.Id&&e!=r.Id)return!0;if(!r.Id&&r.DocumentId&&t!=r.DocumentId)return!0}else{if(r.Id&&e==r.Id)return!0;if(!r.Id&&r.DocumentId&&t==r.DocumentId)return!0}return!1}},{key:"callkeyboard",value:function(){this.orderSer.openkeyboard().subscribe()}},{key:"setKeyBoardInput",value:function(e){this.KeyboardNgModel=e}},{key:"clearSearch",value:function(){this.orderSer.customerList=[],this.orderSer.customerAddressList=[]}},{key:"checkProductVolumeAndSides",value:function(e){var t,r,n,i,o,a,u=e.Product;if((null===(t=this.orderSer.originalProductList)||void 0===t?void 0:t.length)&&(u=this.orderSer.originalProductList.find(function(t){var r;return t.DocumentId==(null===(r=e.Product)||void 0===r?void 0:r.DocumentId)})),(e.ProductVolumName||e.VolumeDocumentId||e.VolumeId||e.VolumeFerpCode)&&!(null===(r=null==u?void 0:u.ProductVolumes)||void 0===r?void 0:r.length)&&(e.ProductVolumName=void 0,e.VolumeDocumentId=void 0,e.VolumeId=void 0,e.VolumeFerpCode=void 0),(null===(n=e.OrderDetailSubItems)||void 0===n?void 0:n.length)&&!(null===(i=null==u?void 0:u.ProductSubItems)||void 0===i?void 0:i.length)&&!(null==u?void 0:u.IsCombo)){var s=null===(o=this.comboProducts)||void 0===o?void 0:o.find(function(e){return e.ProductDocumentId==u.DocumentId});(null===(a=null==s?void 0:s.ComboDetails)||void 0===a?void 0:a.length)||(e.OrderDetailSubItems=[])}}},{key:"totalForAllPay",value:function(e){return(null==e?void 0:e.SubTotal)+(null==e?void 0:e.DeliveryPersonDeliveryPrice)+(null==e?void 0:e.TotalInsuranceAmount)}},{key:"checkWorkTimeFinished",value:function(){var e,t,r,n,i,o=this;this.refreshDateAndTime();var a=null===(t=null===(e=this.orderSer.workTime)||void 0===e?void 0:e.WorkTimeDays)||void 0===t?void 0:t.find(function(e){return e.DayName.toLowerCase()==o.currentMachineDay.toLowerCase()&&e.IsDayActive});if(a&&a.ToTime){var u="",s="",d=0,l=this.getDateFromTime(a.ToTime);(null===(r=this.orderSer.workTime)||void 0===r?void 0:r.ExitSystemWhenShiftEnd)&&this.currentMachineTime>=this.getTimeString(l)?(s="Order.ShiftEnded",u="close",this.orderSer.shiftAlertFired=!1):(null===(n=this.orderSer.workTime)||void 0===n?void 0:n.AlertBeforeEnd)&&(l.setMinutes(l.getMinutes()-(null===(i=this.orderSer.workTime)||void 0===i?void 0:i.AlertBeforeEnd)),this.currentMachineTime>=this.getTimeString(l)&&!this.orderSer.shiftAlertFired&&(s="Order.ShiftAlert",u="alert",d=this.getDateFromTime(a.ToTime).getMinutes()-this.getDateFromTime(this.currentMachineTime).getMinutes(),setTimeout(function(){o.orderSer.shiftAlertFired=!1},6e4*d),this.orderSer.shiftAlertFired=!0)),u&&s&&P.a.fire({title:this.translate.instant("messages.Warning")+"!",text:(d||"")+this.translate.instant(s),icon:"warning",confirmButtonColor:"#3085d6",backdrop:!1,confirmButtonText:this.translate.instant("Shared.Ok")}).then(function(e){e.isConfirmed&&"close"==u&&o.routIfMissingData("workTime",s)})}}},{key:"getDateFromTime",value:function(t){var r=e(t.split(":").map(Number),2),n=r[0],i=r[1],o=new Date;return o.setHours(n,i,0,0),o}},{key:"getScalerWeight",value:function(){var e=this;return new Promise(function(t){e.orderSer.GetScalerWeight().subscribe(function(r){return Object(d.a)(e,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t(r);case 1:case"end":return e.stop()}},e)}))},function(r){e.handeExeptionError(r.error),t(0)})})}},{key:"updatePendingOrders",value:function(e){var t,r,n,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];(null===(t=this.orderSer.settings)||void 0===t?void 0:t.UsePendingOrders)&&(this.pendingOrders=A.a.getByKey(this.pendingOrdersKey)||[],(null==e?void 0:e.Serial)&&1==(null===(r=e.OrderType)||void 0===r?void 0:r.Value)&&(this.pendingOrders.find(function(t){return t.Serial==e.Serial})&&(this.pendingOrders=this.pendingOrders.filter(function(t){return t.Serial!=e.Serial})),i||!(null===(n=null==e?void 0:e.OrderDetails)||void 0===n?void 0:n.length)||e.DocumentId||this.pendingOrders.push(e),A.a.addOrUpdate(this.pendingOrdersKey,this.pendingOrders)),this.pendingOrdersCount=this.pendingOrders.filter(function(t){return t.Serial!=(null==e?void 0:e.Serial)}).length)}},{key:"openPendingOrders",value:function(){var e=this;this.pendingOrders=A.a.getByKey(this.pendingOrdersKey)||[],this.pendingOrders=this.pendingOrders.filter(function(t){var r;return t.Serial!==(null===(r=e.orderobj)||void 0===r?void 0:r.Serial)}),$("#modal-PendingOrders").modal("show")}},{key:"selectPendingOrder",value:function(e){this.orderobj=e,$("#modal-PendingOrders").modal("hide")}},{key:"isOrderPreparationTimeFinished",value:function(e){var r,n,i,o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=(null===(r=this.orderSer.settings)||void 0===r?void 0:r.DefaultOrderPreparationTimeInMinutes)?null===(n=this.orderSer.settings)||void 0===n?void 0:n.DefaultOrderPreparationTimeInMinutes:0;if(o){var u=Math.max.apply(Math,t(null===(i=e.OrderDetails.filter(function(e){var t;return(null===(t=e.Product)||void 0===t?void 0:t.ProductPeriodTime)>0}))||void 0===i?void 0:i.map(function(e){var t;return null===(t=e.Product)||void 0===t?void 0:t.ProductPeriodTime})));u>a&&(a=u)}if(!(null==e?void 0:e.CreationTime)||!a)return!1;var s=new Date(null==e?void 0:e.CreationTime),d=new Date(s.getTime()+60*a*1e3)<new Date;return d&&(e.IsPreparationTimeFinished=!0),!o&&d&&this.toastr.info(this.translate.instant("Order.PreparationTimeFinished")),d}}],[{key:"getDefaultCustomerGroup",value:function(e){if(e&&e.length>0){var t=e.find(function(e){return e.Id>0&&e.DefaultGroup});return t||(t=e.find(function(e){return e.Id>0})),t||(t=e.find(function(e){return e.DefaultGroup})),t}return null}}]),i}(D.a)).\u0275fac=function(e){return new(e||s)(V["\u0275\u0275directiveInject"](w.a),V["\u0275\u0275directiveInject"](k.a),V["\u0275\u0275directiveInject"](M.b),V["\u0275\u0275directiveInject"](N.a),V["\u0275\u0275directiveInject"](F.b),V["\u0275\u0275directiveInject"](j.e))},s.\u0275dir=V["\u0275\u0275defineDirective"]({type:s,features:[V["\u0275\u0275InheritDefinitionFeature"]]}),s)},"9qFR":function(e,t,r){"use strict";r.d(t,"a",function(){return i.a}),r.d(t,"b",function(){return d}),r.d(t,"f",function(){return c.h}),r.d(t,"h",function(){return c.j}),r.d(t,"c",function(){return c.b}),r.d(t,"d",function(){return c.d}),r.d(t,"e",function(){return c.g}),r.d(t,"g",function(){return c.i}),r.d(t,"i",function(){return c.k});var n,i=r("mMi5"),a=(r("4XzM"),r("fXoL")),u=r("tk/3"),s=r("LNWR"),d=((n=function(){function e(t,r){l(this,e),this.http=t,this.common=r}return o(e,[{key:"firstOpen",value:function(){return this.http.get(this.common.rooturl+"/Customer/FirstOpen")}},{key:"getCreditCustomers",value:function(){return this.http.get(this.common.rooturl+"/Customer/GetCreditCustomersAsync")}},{key:"getById",value:function(e){return this.http.get(this.common.rooturl+"/Customer/GetByDocumentID/"+e)}},{key:"print",value:function(e){return this.http.post(this.common.rooturl+"/Customer/print/",e)}},{key:"getGrideList",value:function(){return this.http.get(this.common.rooturl+"/Customer/GetGrideList")}},{key:"preAddUpdate",value:function(){return this.http.get(this.common.rooturl+"/Customer/PreAddUpdate")}},{key:"getCustomerByDocumentId",value:function(e){return this.http.get(this.common.rooturl+"/Customer/GetCustomerByDocumentId/"+e)}},{key:"Pagination",value:function(e){return this.http.get(this.common.rooturl+"/Customer/Pagination/"+e)}},{key:"Transactions",value:function(e,t){return"Post"==t?this.http.post(this.common.rooturl+"/Customer/InsertCustomerFromScreen/",e):"Edit"==t?this.http.put(this.common.rooturl+"/Customer/UpdateCustomer/",e):"Delete"==t?this.http.delete(this.common.rooturl+"/Customer/DeleteCustomerAsync/"+e.DocumentId):void 0}},{key:"insertCustomersFromExcel",value:function(e){return this.http.post(this.common.rooturl+"/Customer/InsertCustomersFromExcel/",e)}}]),e}()).\u0275fac=function(e){return new(e||n)(a["\u0275\u0275inject"](u.b),a["\u0275\u0275inject"](s.a))},n.\u0275prov=a["\u0275\u0275defineInjectable"]({token:n,factory:n.\u0275fac,providedIn:"root"}),n),c=r("TQQS")},Txa1:function(e,t,r){"use strict";r.d(t,"a",function(){return n});var n=function e(){l(this,e)}},U2wp:function(e,t,r){"use strict";r.d(t,"a",function(){return i});var n=r("kLqA"),i=function e(){l(this,e),this.TotalSubItemDisountAmount=0,this.TaxDifferenceValue=0,this.UUID=n.Guid.create().toString()}},bJ22:function(e,t,r){"use strict";r.d(t,"a",function(){return n});var n=function e(){l(this,e)}},cOv9:function(e,t,r){"use strict";r.d(t,"a",function(){return u});var n=r("ngTy"),i=r("bJ22"),o=r("mMi5"),a=r("Txa1"),u=function e(){l(this,e),this.IntegrationCustomerId=null,this.IntegrationCustomerDocumentId=null,this.FromTaxScreen=!1,this.ReservationInfo={},this.requestStarted=!1,this.paymentErrorFired=!1,this.VisaSameOrderPayTimeCount=0,this.orderTypeChangedAfterSave=!1,this.Customer=new o.a,this.Driver=new a.a,this.CustomerAddress=new i.a,this.OrderType=new n.a,this.OrderMasterTaxes=[],this.OrderDetails=[],this.ReturnOrders=[],this.OrderPayments=[],this.OrderInsurance={}}},e3ir:function(e,t,r){"use strict";r.d(t,"a",function(){return n});var n=function e(){l(this,e)}},kLqA:function(e,t,r){"use strict";t.__esModule=!0;var n=function(){function e(t){if(!t)throw new TypeError("Invalid argument; `value` has no value.");this.value=e.EMPTY,t&&e.isGuid(t)&&(this.value=t)}return e.isGuid=function(t){var r=t.toString();return t&&(t instanceof e||e.validator.test(r))},e.create=function(){return new e([e.gen(2),e.gen(1),e.gen(1),e.gen(1),e.gen(3)].join("-"))},e.createEmpty=function(){return new e("emptyguid")},e.parse=function(t){return new e(t)},e.raw=function(){return[e.gen(2),e.gen(1),e.gen(1),e.gen(1),e.gen(3)].join("-")},e.gen=function(e){for(var t="",r=0;r<e;r++)t+=(65536*(1+Math.random())|0).toString(16).substring(1);return t},e.prototype.equals=function(t){return e.isGuid(t)&&this.value===t.toString()},e.prototype.isEmpty=function(){return this.value===e.EMPTY},e.prototype.toString=function(){return this.value},e.prototype.toJSON=function(){return{value:this.value}},e.validator=new RegExp("^[a-z0-9]{8}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{12}$","i"),e.EMPTY="00000000-0000-0000-0000-000000000000",e}();t.Guid=n},mMi5:function(e,t,r){"use strict";r.d(t,"a",function(){return n});var n=function e(){l(this,e)}},ngTy:function(e,t,r){"use strict";r.d(t,"a",function(){return n});var n=function e(){l(this,e)}},tiJv:function(e,t,r){"use strict";r.d(t,"a",function(){return n});var n=function e(){l(this,e)}},"un1/":function(e,t,r){"use strict";function n(e,t){var r=new Date("1970-01-01 ".concat(e)),n=new Date("1970-01-01 ".concat(t)),i=Math.abs(r.getTime()-n.getTime());return Math.floor(i/1e3)}function i(e){if(null===e||"object"!=typeof e)return e;if(e instanceof Date)return new Date(e.getTime());try{return JSON.parse(JSON.stringify(e))}catch(t){throw console.error("Deep copy failed for object:",e,t),new Error("Unable to deep copy object!")}}function o(e){e.Base.StiLicense.key="6vJhGtLLLz2GNviWmUTrhSqnOItdDwjBylQzQcAOiHlkHnETZDQa/PS+0KAqyGT4DpRlgFmGegaxKasr/6hj3WTsNszXi2AnvR96edDIZl0iQK5oAkmli4CDUblYqrhiAJUrUZtKyoZUOSwbjhyDdjuqCk8reDn/QTemFDwWuF4BfzOqXcdV9ceHmq8jqTiwrgF4Bc35HGUqPq+CnYqGQhfU3YY44xsR5JaAuLAXvuP05Oc6F9BQhBMqb6AUXjeD5T9OJWHiIacwv0LbxJAg5a1dVBDPR9E+nJu2dNxkG4EcLY4nf4tOvUh7uhose6Cp5nMlpfXUnY7k7Lq9r0XE/b+q1f11KCXK/t0GpGNnPL5Xy//JCUP7anSZ0SdSbuW8Spxp+r7StU/XLwt9vqKf5rsY9CN8D8u4Mc8RZiSXceDuKyhQo72Eu8yYFswP9COQ4lgOJGcaCv5h9GwR+Iva+coQENBQyY2dItFpsBwSAPvGs2/4V82ztLMsmkTpoAzYupvE2AoddxArDjjTMeyKowMI6qtTyhaF9zTnJ7X7gs09lgTg7Hey5I1Q66QFfcwK"}function a(e,t,r){return Math.min(Math.max(e,t),r)}function u(e){var t;return(null===(t=e.toString().split(".")[1])||void 0===t?void 0:t.length)||0}function s(e,t){return e.reduce(function(e,r){var n=r[t];return e+("number"==typeof n?n:0)},0)}function d(e,t,r){t.loadDocument(r),t.renderAsync();var n=new e.Report.Export.StiHtmlExportSettings,i=new e.Report.Export.StiHtmlExportService,o=new e.System.IO.TextWriter,a=new e.Report.Export.StiHtmlTextWriter(o);i.exportTo(t,a,n);var u=document.createElement("iframe");u.name="frame1",u.style.position="absolute",u.style.top="-1000000px",document.body.appendChild(u);var s=u.contentDocument||u.contentWindow.document;return s.open(),s.write("</head><body>"),s.write(o.getStringBuilder().toString()),s.write("</body></html>"),s.close(),setTimeout(function(){window.frames.frame1.focus(),window.frames.frame1.print(),document.body.removeChild(u)},500),!1}function l(e){var t=e.getDate().toString().padStart(2,"0"),r=(e.getMonth()+1).toString().padStart(2,"0");return"".concat(e.getFullYear(),"-").concat(r,"-").concat(t)}function c(e){var t=e.replace(" PM","").replace(" AM","");return l(new Date(t))}r.d(t,"g",function(){return n}),r.d(t,"c",function(){return i}),r.d(t,"h",function(){return o}),r.d(t,"b",function(){return a}),r.d(t,"d",function(){return u}),r.d(t,"i",function(){return s}),r.d(t,"a",function(){return d}),r.d(t,"f",function(){return l}),r.d(t,"e",function(){return c})},zyXO:function(e,r,n){"use strict";n.d(r,"a",function(){return a});var i=n("fXoL"),a=function(){var e=function(){function e(){l(this,e),this.priceLang="fr"==JSON.parse(localStorage.getItem("langs"))?"fr-FR":"en-US"}return o(e,[{key:"ngOnInit",value:function(){}},{key:"gridLoad",value:function(e,t){t.element.addEventListener("mousedown",function(e){if(e.target.classList.contains("e-rowcell")){t.isEdit&&t.endEdit();var r=parseInt(e.target.getAttribute("Index"));t.selectRow(r),t.startEdit()}})}},{key:"gridCheckBoxBind",value:function(e,t,r,n){var i=t.getRowObjectFromUID(e.event.target.closest("tr").getAttribute("data-uid")).data;e.event.target.closest("td").getAttribute("index"),t.setCellValue(i[r],n,e.checked)}},{key:"clone",value:function(e){return Object.assign({},e)}},{key:"cloneList",value:function(e){return Object.assign([],e)}},{key:"deepCopy",value:function(e){if(null===e||"object"!=typeof e)return e;if(e instanceof Date)return new Date(e.getTime());try{return JSON.parse(JSON.stringify(e))}catch(t){throw console.error("Deep copy failed for object:",e,t),new Error("Unable to deep copy object!")}}},{key:"oldDeepCopy",value:function(e){var t;if(null==e||"object"!=typeof e)return e;if(e instanceof Date)return(t=new Date).setTime(e.getTime()),t;if(e instanceof Array){t=[];for(var r=0,n=e.length;r<n;r++)t[r]=this.deepCopy(e[r]);return t}if(e instanceof Object){for(var i in t={},e)e.hasOwnProperty(i)&&(t[i]=this.deepCopy(e[i]));return t}throw new Error("Unable to copy obj! Its type isn't supported.")}},{key:"clearAllIntervals",value:function(){for(var e=window.setInterval(function(){},Number.MAX_SAFE_INTEGER),t=1;t<e;t++)window.clearInterval(t)}},{key:"filterList",value:function(e,t){var r=[];return e&&e.length>0?t&&""!=t?(Object.keys(e[0]).forEach(function(n){"object"!=typeof e[0][n]&&e.filter(function(e){return e[n]&&e[n].toString().toLowerCase().includes(t.toString().toLowerCase())}).forEach(function(e){-1===r.indexOf(e)&&r.push(e)})}),r):this.deepCopy(e):r}},{key:"filterListByKey",value:function(e,t,r){var n=[];return e&&e.length>0?r&&""!=r?("object"!=typeof e[0][t]&&e.filter(function(e){return e[t]&&e[t].toString().toLowerCase().includes(r.toString().toLowerCase())}).forEach(function(e){-1===n.indexOf(e)&&n.push(e)}),n):this.deepCopy(e):n}},{key:"filterListByKeys",value:function(e,t,r){var n=[];return e&&e.length>0?r&&""!=r?(t.forEach(function(t){"object"!=typeof e[0][t]&&e.filter(function(e){return e[t]&&e[t].toString().toLowerCase().includes(r.toString().toLowerCase())}).forEach(function(e){-1===n.indexOf(e)&&n.push(e)})}),n):this.deepCopy(e):n}},{key:"distinct",value:function(e,r){return t(new Map(e.map(function(e){return[e[r],e]})).values())}},{key:"getDecodedToken",value:function(e){return JSON.parse(atob(e.split(".")[1]))}},{key:"clamp",value:function(e,t,r){return Math.min(Math.max(e,t),r)}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275dir=i["\u0275\u0275defineDirective"]({type:e}),e}()}}])}();